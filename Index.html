import React, { useState, useEffect, useCallback, useRef } from 'react';
import { Calendar, Thermometer, CloudRain, Sun, Wind, AlertTriangle, TrendingUp, MapPin, Clock, Bell, Droplets, Eye, Activity, Settings, Camera, Bug, Leaf, Calculator, Map, BarChart3, Timer, Zap, CheckCircle, Users, MessageCircle, Star, Award, BookOpen, Phone, Volume2, Wifi, WifiOff, DollarSign, Heart, Share, Filter, Search, Send, ThumbsUp, AlertCircle, TrendingDown, ArrowUp, ArrowDown, Shield, Video, Headphones, Download, Wrench, Battery, Cpu, Database, Navigation, Smartphone, Monitor, Upload, Save, RefreshCw, Play, Pause, Home, Menu, X, Plus, Edit3, Trash2, FileText, Image, Mic, MicOff, Speaker, Target, Scissors, Sprout, Wheat, Apple } from 'lucide-react';

// A. í•µì‹¬ ë°ì´í„° êµ¬ì¡° ì •ì˜
const CROP_DATABASE = {
  rice: {
    name: 'ë²¼',
    baseTemp: 10,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì¤€ë¹„', 'ë…¼ ì •ë¦¬'], duration: 7 },
      { stage: 'ë°œì•„', gdd: 120, tasks: ['ë¬¼ ê´€ë¦¬', 'ì˜¨ë„ ì¡°ì ˆ'], duration: 14 },
      { stage: 'ë¶„ì–¼', gdd: 400, tasks: ['ì œì´ˆ', 'ì¶”ë¹„ì‹œìš©'], duration: 30 },
      { stage: 'ìˆ˜ì‰', gdd: 800, tasks: ['ë¬¼ ê¹Šì´ ì¡°ì ˆ', 'ë³‘í•´ì¶© ë°©ì œ'], duration: 35 },
      { stage: 'ì¶œìˆ˜', gdd: 1200, tasks: ['ìˆ˜ë¶„ ê´€ë¦¬', 'ì¡°ë¥˜ ë°©ì œ'], duration: 20 },
      { stage: 'ì„±ìˆ™', gdd: 1600, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ê±´ì¡° ì¤€ë¹„'], duration: 30 }
    ],
    plantingCalendar: {
      early: { month: 4, day: 15, regions: ['ë‚¨ë¶€'] },
      normal: { month: 5, day: 15, regions: ['ì¤‘ë¶€'] },
      late: { month: 6, day: 1, regions: ['ë¶ë¶€'] }
    },
    soilRequirements: { ph: [5.5, 6.5], nitrogen: [100, 150], moisture: [80, 95] },
    pests: ['ë²¼ë©¸êµ¬', 'ë„ì—´ë³‘', 'ìë§ˆë¦„ë³‘'],
    expectedYield: { min: 1.5, max: 2.2, unit: 'kg/í‰' }
  },
  cabbage: {
    name: 'ë°°ì¶”',
    baseTemp: 5,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì†Œë…', 'ìƒí†  ì¤€ë¹„'], duration: 3 },
      { stage: 'ë°œì•„', gdd: 80, tasks: ['ì˜¨ë„ ê´€ë¦¬', 'ìŠµë„ ì¡°ì ˆ'], duration: 7 },
      { stage: 'ë³¸ì—½', gdd: 200, tasks: ['ê°„ì‹', 'ì›ƒê±°ë¦„'], duration: 21 },
      { stage: 'ê²°êµ¬ì‹œì‘', gdd: 500, tasks: ['ì¶©ë¶„í•œ ê´€ìˆ˜', 'í† ì–‘ ê´€ë¦¬'], duration: 20 },
      { stage: 'ê²°êµ¬ì™„ì„±', gdd: 800, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ì €ì¥ ì¤€ë¹„'], duration: 15 }
    ],
    plantingCalendar: {
      spring: { month: 3, day: 15, regions: ['ì „êµ­'] },
      summer: { month: 8, day: 15, regions: ['ì „êµ­'] },
      fall: { month: 9, day: 15, regions: ['ë‚¨ë¶€'] }
    },
    soilRequirements: { ph: [6.0, 7.0], nitrogen: [120, 180], moisture: [60, 75] },
    pests: ['ì§„ë”§ë¬¼', 'ë°°ì¶”ì¢€ë‚˜ë°©', 'ë¬´ë¦„ë³‘'],
    expectedYield: { min: 15, max: 25, unit: 'kg/í‰' }
  }
};

// B. ì§€ì—­ë³„ ê¸°í›„ ë°ì´í„°
const REGIONAL_CLIMATE_DATA = {
  'ê³µì£¼ì‹œ': {
    coordinates: { lat: 36.4645, lng: 127.1204 },
    elevaton: 45,
    climateZone: 'ì¤‘ë¶€ë‚´ë¥™',
    averageTemp: { spring: 12.5, summer: 25.8, fall: 14.2, winter: -1.8 },
    growingSeason: { start: '3ì›” 15ì¼', end: '11ì›” 10ì¼' },
    soilType: 'ì¶©ì í† ',
    annualPrecipitation: 1200,
    frostFreeDays: 195
  }
};

// C. ìƒí™œì ˆê¸° ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
const calculateLivingSeason = (region, currentDate, weatherHistory) => {
  const traditionalSeasons = [
    { name: 'ì…ì¶˜', date: '2024-02-04', temp: 0 },
    { name: 'ìš°ìˆ˜', date: '2024-02-19', temp: 2 },
    { name: 'ê²½ì¹©', date: '2024-03-05', temp: 5 },
    { name: 'ì¶˜ë¶„', date: '2024-03-20', temp: 8 },
    { name: 'ì²­ëª…', date: '2024-04-04', temp: 12 },
    { name: 'ê³¡ìš°', date: '2024-04-20', temp: 15 },
    { name: 'ì…í•˜', date: '2024-05-05', temp: 18 },
    { name: 'ì†Œë§Œ', date: '2024-05-21', temp: 22 },
    { name: 'ë§ì¢…', date: '2024-06-05', temp: 25 },
    { name: 'í•˜ì§€', date: '2024-06-21', temp: 28 },
    { name: 'ì†Œì„œ', date: '2024-07-07', temp: 30 },
    { name: 'ëŒ€ì„œ', date: '2024-07-22', temp: 32 },
    { name: 'ì…ì¶”', date: '2024-08-07', temp: 30 },
    { name: 'ì²˜ì„œ', date: '2024-08-23', temp: 28 },
    { name: 'ë°±ë¡œ', date: '2024-09-07', temp: 25 },
    { name: 'ì¶”ë¶„', date: '2024-09-22', temp: 20 }
  ];

  const currentSeason = traditionalSeasons.find(season => {
    const seasonDate = new Date(season.date);
    return Math.abs(currentDate - seasonDate) < 15 * 24 * 60 * 60 * 1000;
  });

  if (!currentSeason) return null;

  const recentAvgTemp = weatherHistory.slice(-7).reduce((sum, day) => sum + day.avgTemp, 0) / 7;
  const expectedTemp = currentSeason.temp;
  const tempDiff = recentAvgTemp - expectedTemp;
  const dayAdjustment = Math.round(tempDiff / 2);
  
  const livingSeasonDate = new Date(currentSeason.date);
  livingSeasonDate.setDate(livingSeasonDate.getDate() + dayAdjustment);

  return {
    traditional: {
      name: currentSeason.name,
      date: currentSeason.date,
      expectedTemp: expectedTemp
    },
    living: {
      name: `ì‹¤ì§ˆ${currentSeason.name}`,
      date: livingSeasonDate.toISOString().split('T')[0],
      actualTemp: recentAvgTemp,
      adjustment: dayAdjustment > 0 ? `+${dayAdjustment}ì¼` : `${dayAdjustment}ì¼`
    }
  };
};

// D. GDD (Growing Degree Day) ì‹¤ì œ ê³„ì‚°
const calculateRealGDD = (maxTemp, minTemp, baseTemp = 10) => {
  const avgTemp = (maxTemp + minTemp) / 2;
  return Math.max(0, avgTemp - baseTemp);
};

const calculateAccumulatedGDD = (plantingDate, weatherHistory, baseTemp = 10) => {
  const planting = new Date(plantingDate);
  let accumulated = 0;
  
  weatherHistory.forEach(day => {
    const dayDate = new Date(day.date);
    if (dayDate >= planting) {
      accumulated += calculateRealGDD(day.maxTemp, day.minTemp, baseTemp);
    }
  });
  
  return accumulated;
};

// E. ì‘ë¬¼ ìƒìœ¡ë‹¨ê³„ ì‹¤ì‹œê°„ ì¶”ì 
const trackCropGrowthStage = (cropType, plantingDate, gddAccumulated, weatherHistory) => {
  const crop = CROP_DATABASE[cropType];
  if (!crop) return null;

  let currentStageIndex = 0;
  let nextStageIndex = 1;

  for (let i = 0; i < crop.gddStages.length; i++) {
    if (gddAccumulated >= crop.gddStages[i].gdd) {
      currentStageIndex = i;
      nextStageIndex = Math.min(i + 1, crop.gddStages.length - 1);
    }
  }

  const currentStage = crop.gddStages[currentStageIndex];
  const nextStage = crop.gddStages[nextStageIndex];
  
  const gddToNext = nextStage.gdd - gddAccumulated;
  
  const recentAvgGDD = weatherHistory.slice(-7).reduce((sum, day) => 
    sum + calculateRealGDD(day.maxTemp, day.minTemp, crop.baseTemp), 0) / 7;
  
  const estimatedDaysToNext = recentAvgGDD > 0 ? Math.ceil(gddToNext / recentAvgGDD) : null;

  return {
    current: {
      ...currentStage,
      progress: Math.min(100, (gddAccumulated / currentStage.gdd) * 100)
    },
    next: nextStage,
    gddAccumulated,
    gddToNext,
    estimatedDaysToNext,
    overallProgress: (gddAccumulated / crop.gddStages[crop.gddStages.length - 1].gdd) * 100
  };
};

// F. ì´ìƒê¸°í›„ ì¡°ê¸°ê²½ë³´ ì‹œìŠ¤í…œ
const analyzeWeatherRisks = (weatherHistory, forecast) => {
  const risks = [];
  const currentWeather = weatherHistory[weatherHistory.length - 1];
  
  const hotDays = weatherHistory.slice(-7).filter(day => day.maxTemp >= 33).length;
  const extremeHotDays = weatherHistory.slice(-7).filter(day => day.maxTemp >= 35).length;
  
  if (extremeHotDays >= 3) {
    risks.push({
      type: 'HEATWAVE_EXTREME',
      severity: 'critical',
      title: 'ê·¹í•œí­ì—¼ ê²½ë³´',
      message: `${extremeHotDays}ì¼ ì—°ì† 35Â°C ì´ìƒ, ì‘ë¬¼ ê³ ì‚¬ ìœ„í—˜`,
      actions: [
        'ê¸´ê¸‰ ê´€ìˆ˜ ì‹œìŠ¤í…œ ê°€ë™',
        'ì°¨ê´‘ë§ 100% ì„¤ì¹˜',
        'ì˜¤ì „ 6-9ì‹œì—ë§Œ ì‘ì—…',
        'ê°€ì¶• ê·¸ëŠ˜ë§‰ ì ê²€'
      ],
      autoActions: ['START_EMERGENCY_IRRIGATION', 'DEPLOY_SHADE_NETS', 'ACTIVATE_COOLING']
    });
  } else if (hotDays >= 5) {
    risks.push({
      type: 'HEATWAVE_WARNING',
      severity: 'high',
      title: 'í­ì—¼ ì£¼ì˜ë³´',
      message: `${hotDays}ì¼ ì—°ì† ê³ ì˜¨, ì‘ë¬¼ ìŠ¤íŠ¸ë ˆìŠ¤ ì¦ê°€`,
      actions: [
        'ê´€ìˆ˜ëŸ‰ 50% ì¦ëŸ‰',
        'ì°¨ê´‘ë§‰ ì„¤ì¹˜',
        'ì˜¤ì „ ì‘ì—… ê¶Œì¥'
      ],
      autoActions: ['INCREASE_IRRIGATION', 'PARTIAL_SHADING']
    });
  }

  const dryDays = weatherHistory.slice(-14).filter(day => day.rainfall < 1).length;
  const totalRainfall = weatherHistory.slice(-14).reduce((sum, day) => sum + day.rainfall, 0);
  
  if (dryDays >= 14 && totalRainfall < 10) {
    risks.push({
      type: 'DROUGHT_SEVERE',
      severity: 'critical',
      title: 'ì‹¬ê°í•œ ê°€ë­„',
      message: `${dryDays}ì¼ê°„ ê°•ìˆ˜ ë¶€ì¡±, ì´ ê°•ìˆ˜ëŸ‰ ${totalRainfall.toFixed(1)}mm`,
      actions: [
        'ë¹„ìƒ ê¸‰ìˆ˜ ê³„íš ê°€ë™',
        'ê´€ìˆ˜ ìŠ¤ì¼€ì¤„ ì¡°ì •',
        'ì ˆìˆ˜í˜• ì‘ë¬¼ ì „í™˜ ê²€í† '
      ],
      autoActions: ['MAXIMIZE_IRRIGATION', 'WATER_CONSERVATION_MODE']
    });
  }

  return risks.sort((a, b) => {
    const severityOrder = { critical: 3, high: 2, medium: 1, low: 0 };
    return severityOrder[b.severity] - severityOrder[a.severity];
  });
};

// G. ìŠ¤ë§ˆíŠ¸íŒœ ìë™ì œì–´ ì‹œìŠ¤í…œ
const SmartFarmController = {
  calculateIrrigationNeeds: (soilMoisture, weather, cropType, growthStage) => {
    const crop = CROP_DATABASE[cropType];
    const soilReq = crop.soilRequirements;
    
    const targetMoisture = (soilReq.moisture[0] + soilReq.moisture[1]) / 2;
    const moistureDeficit = targetMoisture - soilMoisture;
    
    if (moistureDeficit <= 0) {
      return { action: 'MAINTAIN', duration: 0, reason: 'ì ì • ìˆ˜ë¶„ ìƒíƒœ' };
    }
    
    let intensityMultiplier = 1.0;
    if (weather.maxTemp > 35) intensityMultiplier = 1.5;
    if (weather.humidity < 50) intensityMultiplier *= 1.2;
    if (weather.windSpeed > 10) intensityMultiplier *= 1.1;
    
    const baseDuration = moistureDeficit * 2;
    const adjustedDuration = Math.ceil(baseDuration * intensityMultiplier);
    
    return {
      action: 'START_IRRIGATION',
      duration: adjustedDuration,
      intensity: moistureDeficit > 15 ? 'high' : 'normal',
      reason: `í† ì–‘ìŠµë„ ${soilMoisture}% < ëª©í‘œ ${targetMoisture}%`,
      expectedIncrease: Math.min(moistureDeficit, adjustedDuration * 0.5)
    };
  }
};

// H. AI ê¸°ë°˜ ë³‘í•´ì¶© ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
const PestMonitoringAI = {
  analyzeImage: (imageData, cropType, environmentalData) => {
    const pestDatabase = {
      rice: [
        { name: 'ë²¼ë©¸êµ¬', probability: 0.85, confidence: 'high', treatment: 'ì´ë¯¸ë‹¤í´ë¡œí”„ë¦¬ë“œ 1000ë°°' },
        { name: 'ë„ì—´ë³‘', probability: 0.72, confidence: 'medium', treatment: 'ì¹´ìŠ¤ê°€ë§ˆì´ì‹  1500ë°°' }
      ],
      cabbage: [
        { name: 'ì§„ë”§ë¬¼', probability: 0.91, confidence: 'high', treatment: 'í‹°ì•„ë©”í†¡ì‚¼ 2000ë°°' },
        { name: 'ë°°ì¶”ì¢€ë‚˜ë°©', probability: 0.78, confidence: 'high', treatment: 'í´ë¡œë¥´í˜ë‚˜í”¼ë¥´ 1000ë°°' }
      ]
    };

    const pests = pestDatabase[cropType] || [];
    
    const adjustedPests = pests.map(pest => {
      let adjustedProb = pest.probability;
      
      if (environmentalData.humidity > 80 && environmentalData.temperature > 25) {
        adjustedProb *= 1.2;
      }
      
      if (environmentalData.soilMoisture < 40) {
        adjustedProb *= 1.15;
      }
      
      return {
        ...pest,
        probability: Math.min(adjustedProb, 0.99),
        severity: adjustedProb > 0.8 ? 'high' : adjustedProb > 0.6 ? 'medium' : 'low'
      };
    });

    return adjustedPests.filter(pest => pest.probability > 0.5);
  }
};

// I. ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ AI ì‹œìŠ¤í…œ
const YieldPredictionAI = {
  calculateAdvancedYield: (cropData, weatherHistory, soilData, managementHistory) => {
    const { cropType, plantingDate, area, variety, gddAccumulated } = cropData;
    
    const crop = CROP_DATABASE[cropType];
    const baseYield = (crop.expectedYield.min + crop.expectedYield.max) / 2;
    
    let yieldMultiplier = 1.0;
    
    const optimalGDD = crop.gddStages[crop.gddStages.length - 1].gdd;
    const gddRatio = gddAccumulated / optimalGDD;
    if (gddRatio > 0.8 && gddRatio < 1.2) {
      yieldMultiplier *= 1.1;
    }
    
    const totalRainfall = weatherHistory.reduce((sum, day) => sum + day.rainfall, 0);
    const avgTemp = weatherHistory.reduce((sum, day) => sum + day.avgTemp, 0) / weatherHistory.length;
    const hotDays = weatherHistory.filter(day => day.maxTemp > 35).length;
    
    if (totalRainfall > 800 && totalRainfall < 1400) yieldMultiplier *= 1.05;
    if (avgTemp > 18 && avgTemp < 26) yieldMultiplier *= 1.08;
    if (hotDays > 10) yieldMultiplier *= 0.92;
    
    const predictedYield = baseYield * yieldMultiplier * area / 3.3;
    const confidence = Math.round(85 + (weatherHistory.length > 60 ? 10 : 5));
    
    return {
      predicted: Math.round(predictedYield),
      unit: crop.expectedYield.unit.replace('/í‰', ''),
      confidence: confidence,
      factors: {
        weather: Math.round((yieldMultiplier - 1) * 100),
        soil: 85,
        management: 80,
        gdd: gddRatio > 1 ? 'ë‹¬ì„±' : `${Math.round(gddRatio * 100)}%`
      }
    };
  }
};

// ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
const CompleteFarmingApp = () => {
  // ìƒíƒœ ê´€ë¦¬
  const [currentScreen, setCurrentScreen] = useState('home');
  const [isLoading, setIsLoading] = useState(true);
  const [isOffline, setIsOffline] = useState(false);
  const [voiceEnabled, setVoiceEnabled] = useState(false);
  const [notifications, setNotifications] = useState([]);
  
  // ë†ì—… ë°ì´í„° ìƒíƒœ
  const [userProfile, setUserProfile] = useState({});
  const [farmData, setFarmData] = useState({});
  const [weatherData, setWeatherData] = useState({});
  const [weatherHistory, setWeatherHistory] = useState([]);
  const [crops, setCrops] = useState([]);
  const [sensors, setSensors] = useState({});
  const [devices, setDevices] = useState([]);
  const [alerts, setAlerts] = useState([]);
  const [pestAlerts, setPestAlerts] = useState([]);
  const [yieldPredictions, setYieldPredictions] = useState({});
  const [livingSeasons, setLivingSeasons] = useState({});
  const [automationRules, setAutomationRules] = useState([]);

  // ìŒì„± ì•ˆë‚´ í•¨ìˆ˜
  const speakText = useCallback((text) => {
    if (voiceEnabled && 'speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ko-KR';
      utterance.rate = 0.8;
      speechSynthesis.speak(utterance);
    }
  }, [voiceEnabled]);

  // ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸
  const updateSensorData = useCallback(async () => {
    const newSensorData = {
      timestamp: new Date().toISOString(),
      soilMoisture: 45 + Math.random() * 10,
      soilTemp: 24 + Math.random() * 4,
      airTemp: 32 + Math.random() * 6,
      humidity: 70 + Math.random() * 15,
      ph: 6.2 + Math.random() * 0.6,
      nitrogen: 120 + Math.random() * 20,
      phosphorus: 65 + Math.random() * 15,
      potassium: 180 + Math.random() * 30,
      co2: 420 + Math.random() * 80,
      lightIntensity: 45000 + Math.random() * 10000,
      windSpeed: 5.2 + Math.random() * 3,
      leafWetness: Math.random() * 10,
      leafTemp: 32 + Math.random() * 8
    };
    
    setSensors(newSensorData);
  }, []);

  // J. ë©”ì¸ í™ˆí™”ë©´ ì»´í¬ë„ŒíŠ¸
  const MainHomeScreen = () => {
    const [activeAlert, setActiveAlert] = useState(null);
    const [showDetailedWeather, setShowDetailedWeather] = useState(false);

    return (
      <div className="p-4 space-y-6 pb-24">
        {/* J-1. ê¸´ê¸‰ ì•Œë¦¼ ì„¹ì…˜ */}
        {alerts.length > 0 && (
          <div className="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl p-4 shadow-lg">
            <div className="flex items-center gap-2 text-red-800 font-bold mb-3">
              <AlertTriangle className="w-6 h-6 animate-pulse" />
              ğŸš¨ ê¸´ê¸‰ ë†ì—… ì•Œë¦¼ ({alerts.length}ê±´)
            </div>
            
            {alerts.slice(0, 2).map((alert, idx) => (
              <div key={idx} className="mb-3 last:mb-0">
                <div className="flex items-center justify-between mb-2">
                  <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                    alert.severity === 'critical' ? 'bg-red-500 text-white' :
                    alert.severity === 'high' ? 'bg-orange-500 text-white' :
                    'bg-yellow-500 text-black'
                  }`}>
                    {alert.title}
                  </span>
                  <button 
                    onClick={() => {
                      setActiveAlert(alert);
                      voiceEnabled && speakText(alert.message);
                    }}
                    className="text-red-600 hover:text-red-800"
                  >
                    <Eye className="w-4 h-4" />
                  </button>
                </div>
                <div className="text-red-700 text-sm mb-2">{alert.message}</div>
                
                {alert.actions?.slice(0, 2).map((action, actionIdx) => (
                  <div key={actionIdx} className="flex items-center gap-2 text-xs">
                    <CheckCircle className="w-3 h-3 text-green-600" />
                    <span className="text-red-600">â€¢ {action}</span>
                  </div>
                ))}
                
                {alert.autoActions && (
                  <div className="mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs">
                    <div className="font-semibold text-blue-800 mb-1">ğŸ¤– AI ìë™ëŒ€ì‘</div>
                    {alert.autoActions.map((autoAction, autoIdx) => (
                      <div key={autoIdx} className="text-blue-700">
                        â€¢ {autoAction} âœ… ì‹¤í–‰ì¤‘
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        )}

        {/* J-2. ìƒí™œì ˆê¸° í˜„í™© ì¹´ë“œ */}
        <div className="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Calendar className="w-6 h-6 text-green-600" />
            ì˜¤ëŠ˜ì˜ ìƒí™œì ˆê¸°
          </h3>
          
          <div className="grid grid-cols-2 gap-4 mb-4">
            <div className="text-center p-4 bg-green-100 rounded-lg">
              <div className="text-sm text-gray-600 mb-1">ì „í†µì ˆê¸°</div>
              <div className="font-bold text-xl text-green-700">
                {livingSeasons?.traditional?.name || 'ì²˜ì„œ'}
              </div>
              <div className="text-xs text-gray-500">
                {livingSeasons?.traditional?.date || '8ì›” 23ì¼'}
              </div>
              <div className="text-xs text-green-600 mt-1">
                ì˜ˆìƒê¸°ì˜¨: {livingSeasons?.traditional?.expectedTemp || 28}Â°C
              </div>
            </div>
            <div className="text-center p-4 bg-blue-100 rounded-lg">
              <div className="text-sm text-gray-600 mb-1">ìƒí™œì ˆê¸°</div>
              <div className="font-bold text-xl text-blue-700">
                {livingSeasons?.living?.name || 'ì‹¤ì§ˆì²˜ì„œ'}
              </div>
              <div className="text-xs text-gray-500">
                {livingSeasons?.living?.date || '8ì›” 26ì¼'}
              </div>
              <div className="text-xs text-blue-600 mt-1">
                ì‹¤ì œê¸°ì˜¨: {livingSeasons?.living?.actualTemp?.toFixed(1) || 31.2}Â°C
              </div>
            </div>
          </div>
          
          <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
            <div className="font-semibold text-yellow-800 mb-1">ğŸ“Š ì ˆê¸° ë¶„ì„</div>
            <div className="text-sm text-yellow-700">
              ì˜¬í•´ëŠ” í‰ë…„ë³´ë‹¤ {livingSeasons?.living?.adjustment || '+3ì¼'} ëŠ¦ì€ ì ˆê¸°ë¡œ, 
              ê¸°í›„ë³€í™”ì˜ ì˜í–¥ìœ¼ë¡œ ìƒìœ¡ê¸°ê°„ì´ ì—°ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>

        {/* J-3. ì‹¤ì‹œê°„ ì‘ë¬¼ GDD ì§„í–‰í˜„í™© */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <TrendingUp className="w-6 h-6 text-orange-600" />
            ìƒìœ¡ë„ì¼(GDD) ì‹¤ì‹œê°„ í˜„í™©
          </h3>
          
          {crops.slice(0, 2).map((crop, idx) => {
            const yieldInfo = yieldPredictions[crop.id];
            const stage = crop.growthStage;
            
            return (
              <div key={crop.id} className="mb-6 last:mb-0 p-4 border border-gray-200 rounded-lg">
                <div className="flex justify-between items-center mb-3">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">
                      {crop.type === 'rice' ? 'ğŸŒ¾' : crop.type === 'cabbage' ? 'ğŸ¥¬' : 'ğŸ…'}
                    </div>
                    <div>
                      <div className="font-bold text-lg">{crop.name}</div>
                      <div className="text-sm text-gray-600">{crop.variety} â€¢ {crop.area}í‰</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className={`px-3 py-1 rounded-full text-sm font-semibold ${
                      crop.healthStatus === 'good' ? 'bg-green-100 text-green-700' :
                      crop.healthStatus === 'warning' ? 'bg-yellow-100 text-yellow-700' :
                      'bg-red-100 text-red-700'
                    }`}>
                      {crop.healthStatus === 'good' ? 'ì–‘í˜¸' : 
                       crop.healthStatus === 'warning' ? 'ì£¼ì˜' : 'ìœ„í—˜'}
                    </div>
                  </div>
                </div>
                
                <div className="mb-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-sm font-medium">í˜„ì¬: {stage?.current?.stage}</span>
                    <span className="text-sm text-gray-500">
                      ë‹¤ìŒ: {stage?.next?.stage} (D-{stage?.estimatedDaysToNext || '?'})
                    </span>
                  </div>
                  <div className="bg-gray-200 rounded-full h-4 mb-2">
                    <div 
                      className="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-1000 relative"
                      style={{ width: `${Math.min(stage?.overallProgress || 0, 100)}%` }}
                    >
                      <div className="absolute inset-0 bg-white bg-opacity-30 rounded-full animate-pulse"></div>
                    </div>
                  </div>
                  <div className="flex justify-between text-xs text-gray-600">
                    <span>ëˆ„ì  GDD: {crop.gddAccumulated?.toFixed(0)}Â°C</span>
                    <span>{stage?.overallProgress?.toFixed(1)}% ì™„ë£Œ</span>
                  </div>
                </div>
                
                {stage?.current?.tasks && (
                  <div className="mb-3 p-3 bg-blue-50 rounded-lg">
                    <div className="font-semibold text-blue-800 mb-2">
                      ğŸ“‹ {stage?.current?.stage} ë‹¨ê³„ ê¶Œì¥ì‘ì—…
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {stage?.current?.tasks?.map((task, taskIdx) => (
                        <span key={taskIdx} className="px-2 py-1 bg-blue-200 text-blue-700 rounded text-xs">
                          {task}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
                
                {yieldInfo && (
                  <div className="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div className="font-semibold text-yellow-800 mb-2">ğŸ¯ AI ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡</div>
                    <div className="grid grid-cols-2 gap-3 text-sm">
                      <div>
                        <div className="text-yellow-700">
                          ì˜ˆìƒ ìˆ˜í™•ëŸ‰: <span className="font-bold">{yieldInfo.predicted.toLocaleString()}{yieldInfo.unit}</span>
                        </div>
                        <div className="text-yellow-600">
                          ì‹ ë¢°ë„: {yieldInfo.confidence}%
                        </div>
                      </div>
                      <div>
                        <div className="text-xs space-y-1">
                          <div>ë‚ ì”¨ì˜í–¥: {yieldInfo.factors.weather > 0 ? '+' : ''}{yieldInfo.factors.weather}%</div>
                          <div>í† ì–‘ì ìˆ˜: {yieldInfo.factors.soil}ì </div>
                          <div>GDDë‹¬ì„±: {yieldInfo.factors.gdd}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          })}
        </div>

        {/* K. ì—°ì† ê¸°ìƒ ë¶„ì„ ìœ„ì ¯ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-bold text-xl flex items-center gap-2">
              <CloudRain className="w-6 h-6 text-blue-600" />
              ì—°ì† ê¸°ìƒ ë¶„ì„
            </h3>
            <button 
              onClick={() => setShowDetailedWeather(!showDetailedWeather)}
              className="text-blue-600 hover:text-blue-800"
            >
              {showDetailedWeather ? 'ê°„ë‹¨íˆ' : 'ìƒì„¸íˆ'}
            </button>
          </div>
          
          <div className="grid grid-cols-3 gap-3 mb-4">
            <div className="text-center p-3 bg-red-50 rounded-lg">
              <Thermometer className="w-8 h-8 text-red-500 mx-auto mb-2" />
              <div className="font-bold text-red-600">{weatherData.current?.temp?.toFixed(1)}Â°C</div>
              <div className="text-xs text-red-500">ì²´ê° 35Â°C</div>
            </div>
            <div className="text-center p-3 bg-blue-50 rounded-lg">
              <Droplets className="w-8 h-8 text-blue-500 mx-auto mb-2" />
              <div className="font-bold text-blue-600">{weatherData.current?.humidity?.toFixed(0)}%</div>
              <div className="text-xs text-blue-500">ìŠµë„</div>
            </div>
            <div className="text-center p-3 bg-green-50 rounded-lg">
              <Wind className="w-8 h-8 text-green-500 mx-auto mb-2" />
              <div className="font-bold text-green-600">{weatherData.current?.windSpeed?.toFixed(1)}m/s</div>
              <div className="text-xs text-green-500">í’ì†</div>
            </div>
          </div>
          
          <div className="space-y-2 mb-4">
            {weatherData.forecast?.slice(0, showDetailedWeather ? 7 : 3).map((day, idx) => (
              <div key={idx} className="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                <div className="flex items-center gap-3">
                  <div className="w-16 text-sm font-medium">{day.date}</div>
                  <div className={`px-3 py-1 rounded-full text-xs font-medium ${
                    day.maxTemp >= 35 ? 'bg-red-100 text-red-700' :
                    day.maxTemp >= 33 ? 'bg-orange-100 text-orange-700' : 
                    'bg-green-100 text-green-700'
                  }`}>
                    {day.condition}
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-1">
                    <Thermometer className="w-4 h-4 text-red-500" />
                    <span className="font-semibold">{day.maxTemp.toFixed(0)}Â°</span>
                    <span className="text-gray-500">/{day.minTemp.toFixed(0)}Â°</span>
                  </div>
                  {day.rainfall > 0 && (
                    <div className="flex items-center gap-1">
                      <CloudRain className="w-4 h-4 text-blue-500" />
                      <span className="text-blue-600 text-xs">{day.rainfall.toFixed(1)}mm</span>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
          
          <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
            <div className="font-semibold text-orange-800 mb-2">âš ï¸ ê¸°ìƒ ìœ„í—˜ ìš”ì•½</div>
            <div className="grid grid-cols-2 gap-2 text-xs">
              <div className="text-orange-700">ì—°ì† ê³ ì˜¨: 4ì¼ì§¸</div>
              <div className="text-blue-700">ë¬´ê°•ìˆ˜: 3ì¼ì§¸</div>
              <div className="text-red-700">í­ì—¼ ì˜ˆìƒ: ë‚´ì¼</div>
              <div className="text-green-700">ë°”ëŒ: ì•½í•¨</div>
            </div>
          </div>
        </div>

        {/* L. ìŠ¤ë§ˆíŠ¸íŒœ ìë™ì œì–´ í˜„í™© */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Zap className="w-6 h-6 text-yellow-600" />
            AI ìŠ¤ë§ˆíŠ¸íŒœ ìë™ì œì–´
          </h3>
          
          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="p-3 bg-blue-50 rounded-lg">
              <div className="flex items-center gap-2 mb-2">
                <Database className="w-5 h-5 text-blue-600" />
                <span className="font-medium text-blue-800">í† ì–‘ ì„¼ì„œ</span>
              </div>
              <div className="space-y-1 text-sm">
                <div className="flex justify-between">
                  <span>ìŠµë„:</span>
                  <span className="font-bold text-blue-600">{sensors.soilMoisture?.toFixed(0)}%</span>
                </div>
                <div className="flex justify-between">
                  <span>ì˜¨ë„:</span>
                  <span className="font-bold text-blue-600">{sensors.soilTemp?.toFixed(1)}Â°C</span>
                </div>
                <div className="flex justify-between">
                  <span>pH:</span>
                  <span className="font-bold text-blue-600">{sensors.ph?.toFixed(1)}</span>
                </div>
              </div>
            </div>
            
            <div className="p-3 bg-green-50 rounded-lg">
              <div className="flex items-center gap-2 mb-2">
                <Activity className="w-5 h-5 text-green-600" />
                <span className="font-medium text-green-800">í™˜ê²½ ì„¼ì„œ</span>
              </div>
              <div className="space-y-1 text-sm">
                <div className="flex justify-between">
                  <span>CO2:</span>
                  <span className="font-bold text-green-600">{sensors.co2?.toFixed(0)}ppm</span>
                </div>
                <div className="flex justify-between">
                  <span>ì¡°ë„:</span>
                  <span className="font-bold text-green-600">{(sensors.lightIntensity/1000)?.toFixed(0)}klx</span>
                </div>
                <div className="flex justify-between">
                  <span>ììŠµìœ¤:</span>
                  <span className="font-bold text-green-600">{sensors.leafWetness?.toFixed(1)}h</span>
                </div>
              </div>
            </div>
          </div>
          
          <div className="space-y-3">
            {devices.slice(0, 3).map((device, idx) => (
              <div key={idx} className="p-3 border border-gray-200 rounded-lg">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-3">
                    {device.type === 'irrigation' && <Droplets className="w-5 h-5 text-blue-600" />}
                    {device.type === 'ventilation' && <Wind className="w-5 h-5 text-green-600" />}
                    {device.type === 'lighting' && <Sun className="w-5 h-5 text-yellow-600" />}
                    <div>
                      <div className="font-medium">{device.name || `${device.type} ì‹œìŠ¤í…œ`}</div>
                      <div className="text-xs text-gray-500">ë§ˆì§€ë§‰ ì‘ë™: {device.lastAction || '10ë¶„ ì „'}</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="flex items-center gap-1">
                      <Battery className="w-4 h-4 text-gray-500" />
                      <span className="text-xs">{device.battery || 88}%</span>
                    </div>
                    <div className={`w-3 h-3 rounded-full ${
                      device.status === 'active' ? 'bg-green-400' :
                      device.status === 'standby' ? 'bg-yellow-400' : 'bg-gray-400'
                    }`} />
                  </div>
                </div>
                <div className="text-xs text-gray-600">
                  ìë™ëª¨ë“œ: {device.autoMode ? 'ğŸŸ¢ ON' : 'ğŸ”´ OFF'} | 
                  ìƒíƒœ: {device.status === 'active' ? 'ê°€ë™ì¤‘' : device.status === 'standby' ? 'ëŒ€ê¸°ì¤‘' : 'ì˜¤í”„ë¼ì¸'}
                </div>
              </div>
            ))}
          </div>
          
          <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div className="font-semibold text-yellow-800 mb-2">ğŸ¤– í™œì„±í™”ëœ ìë™í™” ë£°</div>
            <div className="space-y-1 text-sm">
              {automationRules.filter(rule => rule.enabled).map((rule, idx) => (
                <div key={idx} className="flex items-center justify-between">
                  <span className="text-yellow-700">â€¢ {rule.name}</span>
                  <span className="text-green-600 font-medium">âœ“ í™œì„±</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* M. ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‘ì—… (AI ê¸°ë°˜) */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Target className="w-6 h-6 text-purple-600" />
            AI ì¶”ì²œ ì‘ì—… ë¦¬ìŠ¤íŠ¸
          </h3>
          
          <div className="space-y-3">
            <div className="p-4 bg-red-50 border-l-4 border-red-400 rounded-lg" 
                 onClick={() => voiceEnabled && speakText('ê¸´ê¸‰ ê´€ìˆ˜ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤')}>
              <div className="flex items-start justify-between mb-2">
                <div className="flex items-center gap-3">
                  <Bell className="w-6 h-6 text-red-600 animate-bounce" />
                  <div>
                    <div className="font-bold text-red-800">ê¸´ê¸‰: ì˜¤ì „ ê´€ìˆ˜ í•„ìˆ˜</div>
                    <div className="text-sm text-red-600">í† ì–‘ìŠµë„ {sensors.soilMoisture?.toFixed(0)}%, ì„ê³„ì  ë„ë‹¬</div>
                  </div>
                </div>
                <span className="px-3 py-1 bg-red-500 text-white rounded-full text-xs font-bold">
                  D-0
                </span>
              </div>
              <div className="grid grid-cols-2 gap-3 text-xs">
                <div>
                  <div className="text-red-700">ì˜ˆìƒ ì†Œìš”ì‹œê°„: 2ì‹œê°„</div>
                  <div className="text-red-600">ì ì • ì‹œê°„: ì˜¤ì „ 6-10ì‹œ</div>
                </div>
                <div>
                  <div className="text-red-700">í•„ìš” ê¸‰ìˆ˜ëŸ‰: 1,200L</div>
                  <div className="text-red-600">ìë™ì œì–´: ëŒ€ê¸°ì¤‘</div>
                </div>
              </div>
            </div>
            
            <div className="p-4 bg-orange-50 border-l-4 border-orange-400 rounded-lg">
              <div className="flex items-start justify-between mb-2">
                <div className="flex items-center gap-3">
                  <Bug className="w-6 h-6 text-orange-600" />
                  <div>
                    <div className="font-bold text-orange-800">ë³‘í•´ì¶© ì˜ˆë°© ë°©ì œ</div>
                    <div className="text-sm text-orange-600">AI ë¶„ì„: ë²¼ë©¸êµ¬ ë°œìƒ ìœ„í—˜ 85%</div>
                  </div>
                </div>
                <span className="px-3 py-1 bg-orange-500 text-white rounded-full text-xs font-bold">
                  D-2
                </span>
              </div>
              <div className="text-xs text-orange-700 space-y-1">
                <div>â€¢ ê¶Œì¥ ì•½ì œ: ì´ë¯¸ë‹¤í´ë¡œí”„ë¦¬ë“œ 1000ë°° í¬ì„</div>
                <div>â€¢ ì‚´í¬ ë©´ì : 3,000í‰ (1êµ¬ì—­ ë…¼)</div>
                <div>â€¢ ì˜ˆìƒ ë¹„ìš©: 150,000ì›</div>
              </div>
            </div>
            
            <div className="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
              <div className="flex items-start justify-between mb-2">
                <div className="flex items-center gap-3">
                  <Eye className="w-6 h-6 text-blue-600" />
                  <div>
                    <div className="font-bold text-blue-800">ë²¼ ìˆ˜ì‰ê¸° ìƒìœ¡ ì ê²€</div>
                    <div className="text-sm text-blue-600">GDD 890Â°C ë‹¬ì„±, ì´ì‚­ í˜•ì„± í™•ì¸</div>
                  </div>
                </div>
                <span className="px-3 py-1 bg-blue-500 text-white rounded-full text-xs font-bold">
                  D-5
                </span>
              </div>
              <div className="text-xs text-blue-700 space-y-1">
                <div>â€¢ ì ê²€ í•­ëª©: ì´ì‚­ ê¸¸ì´, ì•Œ í˜•ì„± ìƒíƒœ</div>
                <div>â€¢ ì†Œìš”ì‹œê°„: 1ì‹œê°„</div>
                <div>â€¢ ê¸°ë¡ í•„ìš”: ìƒìœ¡ ë‹¨ê³„ë³„ ì‚¬ì§„</div>
              </div>
            </div>
          </div>
          
          <div className="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
            <div className="font-semibold text-green-800 mb-2">âœ… ì˜¤ëŠ˜ ì™„ë£Œëœ ì‘ì—…</div>
            <div className="space-y-1 text-sm text-green-700">
              <div>â€¢ ë…¼ ë¬¼ ê¹Šì´ ì¡°ì ˆ (ì˜¤ì „ 7ì‹œ)</div>
              <div>â€¢ ì œì´ˆì œ ì‚´í¬ (ì˜¤ì „ 9ì‹œ)</div>
              <div>â€¢ ì„¼ì„œ ë°ì´í„° ì ê²€ (ì˜¤ì „ 11ì‹œ)</div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    const initializeApp = async () => {
      setIsLoading(true);
      
      try {
        setUserProfile({
          id: 'user001',
          name: 'ê¹€ë†ë¶€',
          experience: 15,
          age: 55,
          location: 'ê³µì£¼ì‹œ ìœ êµ¬ì',
          speciality: 'ë²¼ë†ì‚¬',
          farmSize: 5000,
          membershipLevel: 'premium',
          cropsGrown: ['ë²¼', 'ë°°ì¶”', 'í† ë§ˆí† '],
          achievements: ['ìš°ìˆ˜ë†ê°€ìƒ', 'ì¹œí™˜ê²½ì¸ì¦'],
          points: 3450,
          level: 'Gold'
        });

        setFarmData({
          totalArea: 5000,
          fields: [
            {
              id: 'field001',
              name: '1êµ¬ì—­ ë…¼',
              crop: 'rice',
              variety: 'ì¶”ì²­',
              area: 3000,
              coordinates: { lat: 36.4645, lng: 127.1204 },
              plantingDate: '2024-05-15',
              expectedHarvest: '2024-10-15'
            },
            {
              id: 'field002', 
              name: '2êµ¬ì—­ ë°­',
              crop: 'cabbage',
              variety: 'ë¶ˆì•”3í˜¸',
              area: 1500,
              coordinates: { lat: 36.4650, lng: 127.1210 },
              plantingDate: '2024-08-01',
              expectedHarvest: '2024-11-01'
            }
          ]
        });

        const history = [];
        for (let i = 89; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          
          history.push({
            date: date.toISOString().split('T')[0],
            maxTemp: 28 + Math.sin((date.getTime() / (1000 * 60 * 60 * 24)) * 0.1) * 8 + Math.random() * 6,
            minTemp: 18 + Math.sin((date.getTime() / (1000 * 60 * 60 * 24)) * 0.1) * 6 + Math.random() * 4,
            avgTemp: 23 + Math.sin((date.getTime() / (1000 * 60 * 60 * 24)) * 0.1) * 7 + Math.random() * 3,
            rainfall: Math.random() > 0.7 ? Math.random() * 25 : 0,
            humidity: 65 + Math.random() * 25,
            windSpeed: 3 + Math.random() * 8
          });
        }
        setWeatherHistory(history);

        const today = history[history.length - 1];
        setWeatherData({
          current: {
            temp: today.avgTemp,
            maxTemp: today.maxTemp,
            minTemp: today.minTemp,
            humidity: today.humidity,
            windSpeed: today.windSpeed,
            rainfall: today.rainfall
          },
          forecast: [
            { date: 'ì˜¤ëŠ˜', maxTemp: 34, minTemp: 22, condition: 'ë§‘ìŒ', rainfall: 0 },
            { date: 'ë‚´ì¼', maxTemp: 36, minTemp: 24, condition: 'í­ì—¼', rainfall: 0 },
            { date: 'ëª¨ë ˆ', maxTemp: 32, minTemp: 20, condition: 'êµ¬ë¦„', rainfall: 2 },
            { date: '3ì¼ í›„', maxTemp: 29, minTemp: 18, condition: 'ì†Œë‚˜ê¸°', rainfall: 15 }
          ]
        });

        const cropsData = farmData.fields.map(field => {
          const gdd = calculateAccumulatedGDD(field.plantingDate, history, CROP_DATABASE[field.crop]?.baseTemp || 10);
          const growthInfo = trackCropGrowthStage(field.crop, field.plantingDate, gdd, history);
          
          return {
            id: field.id,
            fieldId: field.id,
            name: CROP_DATABASE[field.crop]?.name || field.crop,
            type: field.crop,
            variety: field.variety,
            area: field.area,
            plantingDate: field.plantingDate,
            gddAccumulated: gdd,
            growthStage: growthInfo,
            healthStatus: Math.random() > 0.7 ? 'warning' : 'good'
          };
        });
        setCrops(cropsData);

        const currentDate = new Date();
        const seasons = calculateLivingSeason('ê³µì£¼ì‹œ', currentDate, history);
        setLivingSeasons(seasons);

        const predictions = {};
        cropsData.forEach(crop => {
          predictions[crop.id] = YieldPredictionAI.calculateAdvancedYield(
            {
              cropType: crop.type,
              plantingDate: crop.plantingDate,
              area: crop.area,
              variety: crop.variety,
              gddAccumulated: crop.gddAccumulated
            },
            history,
            { ph: 6.2, nitrogen: 120, phosphorus: 65, potassium: 180, moisture: 65 },
            []
          );
        });
        setYieldPredictions(predictions);

        const risks = analyzeWeatherRisks(history, []);
        setAlerts(risks);

        setDevices([
          {
            id: 1, name: '1êµ¬ì—­ ê´€ìˆ˜ì‹œìŠ¤í…œ', type: 'irrigation',
            status: 'active', lastAction: '2ë¶„ ì „ ìë™ ê°€ë™',
            autoMode: true, battery: 85
          },
          {
            id: 2, name: 'ì˜¨ì‹¤ í™˜ê¸°ì‹œìŠ¤í…œ', type: 'ventilation',
            status: 'standby', lastAction: '30ë¶„ ì „ í™˜ê¸° ì™„ë£Œ',
            autoMode: true, battery: 92
          }
        ]);

        setAutomationRules([
          {
            id: 'rule001',
            name: 'í† ì–‘ìŠµë„ ê¸°ë°˜ ìë™ê´€ìˆ˜',
            enabled: true
          },
          {
            id: 'rule002', 
            name: 'ê³ ì˜¨ ì‹œ ìë™í™˜ê¸°',
            enabled: true
          }
        ]);

        await updateSensorData();
        setIsLoading(false);
        
      } catch (error) {
        console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        setIsLoading(false);
      }
    };

    initializeApp();
  }, [updateSensorData]);

  useEffect(() => {
    const interval = setInterval(() => {
      if (!isOffline) {
        updateSensorData();
      }
    }, 5 * 60 * 1000);

    return () => clearInterval(interval);
  }, [isOffline, updateSensorData]);

  useEffect(() => {
    const handleOnline = () => setIsOffline(false);
    const handleOffline = () => setIsOffline(true);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  if (isLoading) {
    return (
      <div className="min-h-screen bg-green-600 flex items-center justify-center">
        <div className="text-center text-white">
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
          <h2 className="text-xl font-bold mb-2">ë†ì¥ ë°ì´í„° ë¡œë”© ì¤‘...</h2>
          <p className="opacity-80">ì„¼ì„œ ì—°ê²° ë° ë°ì´í„° ë¶„ì„ ì¤‘</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="bg-green-600 text-white p-4 sticky top-0 z-50">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Leaf className="w-8 h-8" />
            <div>
              <h1 className="text-xl font-bold">ìŠ¤ë§ˆíŠ¸ ìƒí™œì ˆê¸°</h1>
              <p className="text-xs opacity-90">AI ë†ì—… í†µí•© í”Œë«í¼</p>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            {isOffline ? (
              <WifiOff className="w-5 h-5 text-red-300" />
            ) : (
              <Wifi className="w-5 h-5 text-green-300" />
            )}
            
            <button 
              onClick={() => setVoiceEnabled(!voiceEnabled)}
              className={`p-2 rounded ${voiceEnabled ? 'bg-green-500' : 'bg-green-700'}`}
            >
              <Volume2 className="w-5 h-5" />
            </button>
            
            <button className="relative">
              <Bell className="w-5 h-5" />
              {notifications.length > 0 && (
                <span className="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">
                  {notifications.length}
                </span>
              )}
            </button>
            
            <div className="text-xs text-center">
              <div>{userProfile.level}</div>
              <div className="text-yellow-200">{userProfile.points}P</div>
            </div>
          </div>
        </div>
      </div>

      <div className="pb-20">
        {currentScreen === 'home' && <MainHomeScreen />}
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2">
        <div className="flex justify-around">
          <button
            onClick={() => setCurrentScreen('home')}
            className={`flex flex-col items-center p-2 ${
              currentScreen === 'home' ? 'text-green-600' : 'text-gray-500'
            }`}
          >
            <Clock className="w-6 h-6" />
            <span className="text-xs mt-1">í™ˆ</span>
          </button>
          <button className="flex flex-col items-center p-2 text-gray-400">
            <Calendar className="w-6 h-6" />
            <span className="text-xs mt-1">ì ˆê¸°ë‹¬ë ¥</span>
          </button>
          <button className="flex flex-col items-center p-2 text-gray-400">
            <Map className="w-6 h-6" />
            <span className="text-xs mt-1">ë†ì¥ê´€ë¦¬</span>
          </button>
          <button className="flex flex-col items-center p-2 text-gray-400">
            <Users className="w-6 h-6" />
            <span className="text-xs mt-1">ì»¤ë®¤ë‹ˆí‹°</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default CompleteFarmingApp;
// 1ë¶€ì—ì„œ ì´ì–´ë°›ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ê³¼ ìƒíƒœë“¤...
// N. ì‹¤ì‹œê°„ ì•Œë¦¼ ë° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ í—ˆë¸Œ (1ë¶€ í™ˆí™”ë©´ì— ì¶”ê°€)

// O. ì ˆê¸° ë‹¬ë ¥ í™”ë©´ ì»´í¬ë„ŒíŠ¸
const SeasonCalendarScreen = ({ 
  livingSeasons, 
  weatherHistory, 
  crops, 
  voiceEnabled, 
  speakText 
}) => {
  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
  const [viewMode, setViewMode] = useState('combined');

  const seasonalCalendar = {
    2: { traditional: 'ì…ì¶˜(2/4), ìš°ìˆ˜(2/19)', living: 'ì‹¤ì§ˆì…ì¶˜(2/7), ì‹¤ì§ˆìš°ìˆ˜(2/21)' },
    3: { traditional: 'ê²½ì¹©(3/5), ì¶˜ë¶„(3/20)', living: 'ì‹¤ì§ˆê²½ì¹©(3/8), ì‹¤ì§ˆì¶˜ë¶„(3/23)' },
    4: { traditional: 'ì²­ëª…(4/4), ê³¡ìš°(4/20)', living: 'ì‹¤ì§ˆì²­ëª…(4/7), ì‹¤ì§ˆê³¡ìš°(4/23)' },
    5: { traditional: 'ì…í•˜(5/5), ì†Œë§Œ(5/21)', living: 'ì‹¤ì§ˆì…í•˜(5/8), ì‹¤ì§ˆì†Œë§Œ(5/24)' },
    6: { traditional: 'ë§ì¢…(6/5), í•˜ì§€(6/21)', living: 'ì‹¤ì§ˆë§ì¢…(6/8), ì‹¤ì§ˆí•˜ì§€(6/24)' },
    7: { traditional: 'ì†Œì„œ(7/7), ëŒ€ì„œ(7/22)', living: 'ì‹¤ì§ˆì†Œì„œ(7/10), ì‹¤ì§ˆëŒ€ì„œ(7/25)' },
    8: { traditional: 'ì…ì¶”(8/7), ì²˜ì„œ(8/23)', living: 'ì‹¤ì§ˆì…ì¶”(8/10), ì‹¤ì§ˆì²˜ì„œ(8/26)' },
    9: { traditional: 'ë°±ë¡œ(9/7), ì¶”ë¶„(9/22)', living: 'ì‹¤ì§ˆë°±ë¡œ(9/10), ì‹¤ì§ˆì¶”ë¶„(9/25)' },
    10: { traditional: 'í•œë¡œ(10/8), ìƒê°•(10/23)', living: 'ì‹¤ì§ˆí•œë¡œ(10/11), ì‹¤ì§ˆìƒê°•(10/26)' },
    11: { traditional: 'ì…ë™(11/7), ì†Œì„¤(11/22)', living: 'ì‹¤ì§ˆì…ë™(11/10), ì‹¤ì§ˆì†Œì„¤(11/25)' }
  };

  const cropCalendar = {
    rice: {
      2: 'ì¢…ì ì¤€ë¹„, ë†ê¸°ê³„ ì ê²€',
      3: 'íŒŒì¢…ìƒ ì¤€ë¹„, ìƒí†  í˜¼í•©',
      4: 'íŒŒì¢…, ìœ¡ë¬˜ ê´€ë¦¬',
      5: 'ì´ì•™, ë¬¼ ê´€ë¦¬',
      6: 'ì œì´ˆ, ì¶”ë¹„ ì‹œìš©',
      7: 'ë¬¼ ê´€ë¦¬, ë³‘í•´ì¶© ë°©ì œ',
      8: 'ìˆ˜ì‰ê¸° ê´€ë¦¬, ì´ì‚­ ê´€ì°°',
      9: 'ì¶œìˆ˜ê¸° ê´€ë¦¬, ìˆ˜ë¶„ ì¡°ì ˆ',
      10: 'ì„±ìˆ™ê¸° ê´€ë¦¬, ìˆ˜í™• ì¤€ë¹„',
      11: 'ìˆ˜í™•, ê±´ì¡°'
    },
    cabbage: {
      3: 'ë´„ë°°ì¶” íŒŒì¢…',
      4: 'ì •ì‹, ë¬¼ì£¼ê¸°',
      5: 'ì›ƒê±°ë¦„, ë³‘í•´ì¶© ë°©ì œ',
      8: 'ê°€ì„ë°°ì¶” íŒŒì¢…',
      9: 'ì •ì‹, ì´ˆê¸° ê´€ë¦¬',
      10: 'ê²°êµ¬ê¸° ê´€ë¦¬',
      11: 'ìˆ˜í™•'
    }
  };

  return (
    <div className="p-4 space-y-6 pb-24">
      {/* O-1. ë‹¬ë ¥ í—¤ë” ë° ë·° ëª¨ë“œ ì„ íƒ */}
      <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl p-5">
        <h2 className="text-2xl font-bold mb-4">ğŸ“… 2024ë…„ ìƒí™œì ˆê¸° ë‹¬ë ¥</h2>
        
        <div className="flex gap-2 mb-4">
          {[
            { key: 'traditional', label: 'ì „í†µì ˆê¸°', icon: 'ğŸ›ï¸' },
            { key: 'living', label: 'ìƒí™œì ˆê¸°', icon: 'ğŸŒ¡ï¸' },
            { key: 'combined', label: 'í†µí•©ë·°', icon: 'ğŸ“Š' }
          ].map(mode => (
            <button
              key={mode.key}
              onClick={() => setViewMode(mode.key)}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                viewMode === mode.key
                  ? 'bg-white text-green-600'
                  : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
              }`}
            >
              {mode.icon} {mode.label}
            </button>
          ))}
        </div>
        
        <div className="flex gap-2 overflow-x-auto">
          {Array.from({length: 12}, (_, i) => i).map(month => (
            <button
              key={month}
              onClick={() => setSelectedMonth(month)}
              className={`px-3 py-2 rounded-lg text-sm whitespace-nowrap transition-colors ${
                selectedMonth === month
                  ? 'bg-white text-green-600 font-bold'
                  : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
              }`}
            >
              {month + 1}ì›”
            </button>
          ))}
        </div>
      </div>

      {/* O-2. í˜„ì¬ ì ˆê¸° ìƒíƒœ */}
      <div className="bg-white rounded-xl shadow-lg p-5">
        <h3 className="font-bold text-lg mb-4">ğŸŒŸ í˜„ì¬ ì ˆê¸° ìƒì„¸ ì •ë³´</h3>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div className="p-4 bg-green-50 border border-green-200 rounded-lg">
            <div className="flex items-center gap-2 mb-3">
              <div className="text-2xl">ğŸ›ï¸</div>
              <div>
                <div className="font-bold text-green-800">ì „í†µì ˆê¸°</div>
                <div className="text-sm text-green-600">ìŒë ¥ ê¸°ì¤€ ê³ ì •</div>
              </div>
            
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr className="bg-gray-50 border-b">
                    <th className="px-4 py-3 text-left font-medium">ì„¼ì„œ í•­ëª©</th>
                    <th className="px-4 py-3 text-center font-medium">í˜„ì¬ê°’</th>
                    <th className="px-4 py-3 text-center font-medium">ìµœì ë²”ìœ„</th>
                    <th className="px-4 py-3 text-center font-medium">ìƒíƒœ</th>
                    <th className="px-4 py-3 text-center font-medium">ìµœê·¼ ë³€í™”</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {[
                    { name: 'í† ì–‘ ì˜¨ë„', value: sensors.soilTemp?.toFixed(1) + 'Â°C', optimal: '20-28Â°C', status: 'good', change: '+0.5Â°C' },
                    { name: 'ì§ˆì†Œ (N)', value: sensors.nitrogen?.toFixed(0) + 'ppm', optimal: '100-150ppm', status: 'good', change: '-5ppm' },
                    { name: 'ì¸ì‚° (P)', value: sensors.phosphorus?.toFixed(0) + 'ppm', optimal: '50-80ppm', status: 'good', change: '+2ppm' },
                    { name: 'ì¹¼ë¥¨ (K)', value: sensors.potassium?.toFixed(0) + 'ppm', optimal: '150-200ppm', status: 'good', change: '+8ppm' },
                    { name: 'CO2', value: sensors.co2?.toFixed(0) + 'ppm', optimal: '350-450ppm', status: 'good', change: '+15ppm' },
                    { name: 'í’ì†', value: sensors.windSpeed?.toFixed(1) + 'm/s', optimal: '2-8m/s', status: 'good', change: '-0.3m/s' },
                    { name: 'ì ìŠµìœ¤ë„', value: sensors.leafWetness?.toFixed(1) + 'h', optimal: '<4h', status: sensors.leafWetness > 4 ? 'warning' : 'good', change: '+1.2h' }
                  ].map((item, idx) => (
                    <tr key={idx} className="hover:bg-gray-50">
                      <td className="px-4 py-3 font-medium">{item.name}</td>
                      <td className="px-4 py-3 text-center font-bold">{item.value}</td>
                      <td className="px-4 py-3 text-center text-gray-600">{item.optimal}</td>
                      <td className="px-4 py-3 text-center">
                        <span className={`px-2 py-1 rounded-full text-xs ${
                          item.status === 'good' ? 'bg-green-100 text-green-700' :
                          item.status === 'warning' ? 'bg-yellow-100 text-yellow-700' :
                          'bg-red-100 text-red-700'
                        }`}>
                          {item.status === 'good' ? 'ì •ìƒ' : item.status === 'warning' ? 'ì£¼ì˜' : 'ìœ„í—˜'}
                        </span>
                      </td>
                      <td className="px-4 py-3 text-center text-gray-600">{item.change}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
          
          <div className="bg-white rounded-xl shadow-lg p-5">
            <h3 className="font-bold text-lg mb-4">ğŸ“ˆ 24ì‹œê°„ ì„¼ì„œ íŠ¸ë Œë“œ</h3>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <div className="font-medium mb-3">ì˜¨ë„ ë³€í™”</div>
                <div className="bg-red-50 rounded-lg p-4 h-32 flex items-end gap-1">
                  {Array.from({length: 24}, (_, i) => (
                    <div
                      key={i}
                      className="bg-red-400 rounded-t min-w-[8px] flex-1 transition-all duration-300 hover:bg-red-500"
                      style={{ 
                        height: `${20 + Math.sin(i * 0.5) * 15 + Math.random() * 10}%` 
                      }}
                      title={`${i}ì‹œ: ${(25 + Math.sin(i * 0.5) * 8).toFixed(1)}Â°C`}
                    ></div>
                  ))}
                </div>
                <div className="flex justify-between text-xs text-gray-500 mt-1">
                  <span>0ì‹œ</span>
                  <span>12ì‹œ</span>
                  <span>24ì‹œ</span>
                </div>
              </div>
              
              <div>
                <div className="font-medium mb-3">ìŠµë„ ë³€í™”</div>
                <div className="bg-blue-50 rounded-lg p-4 h-32 flex items-end gap-1">
                  {Array.from({length: 24}, (_, i) => (
                    <div
                      key={i}
                      className="bg-blue-400 rounded-t min-w-[8px] flex-1 transition-all duration-300 hover:bg-blue-500"
                      style={{ 
                        height: `${40 + Math.sin(i * 0.3) * 20 + Math.random() * 15}%` 
                      }}
                      title={`${i}ì‹œ: ${(60 + Math.sin(i * 0.3) * 25).toFixed(0)}%`}
                    ></div>
                  ))}
                </div>
                <div className="flex justify-between text-xs text-gray-500 mt-1">
                  <span>0ì‹œ</span>
                  <span>12ì‹œ</span>
                  <span>24ì‹œ</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* P-4. ì¥ë¹„ ì œì–´ íƒ­ */}
      {activeTab === 'devices' && (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-lg p-5">
            <h3 className="font-bold text-lg mb-4">ğŸ›ï¸ ìŠ¤ë§ˆíŠ¸íŒœ ì¥ë¹„ ì œì–´</h3>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="p-4 border border-blue-200 rounded-lg">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">ğŸ’§</div>
                    <div>
                      <div className="font-bold text-blue-800">ìë™ ê´€ìˆ˜ ì‹œìŠ¤í…œ</div>
                      <div className="text-sm text-gray-600">1,2,3êµ¬ì—­ í†µí•© ì œì–´</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                    <span className="text-sm text-green-600">ê°€ë™ì¤‘</span>
                  </div>
                </div>
                
                <div className="space-y-3 mb-4">
                  <div className="flex justify-between text-sm">
                    <span>í˜„ì¬ ì¶œë ¥:</span>
                    <span className="font-bold">75% (1,200L/h)</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span>ê°€ë™ ì‹œê°„:</span>
                    <span className="font-bold">2ì‹œê°„ 35ë¶„</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span>ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰:</span>
                    <span className="font-bold">3,840L</span>
                  </div>
                </div>
                
                <div className="bg-blue-50 rounded p-3 mb-4">
                  <div className="font-medium text-blue-800 mb-2">ğŸ¤– AI ìë™ ì œì–´</div>
                  <div className="text-sm text-blue-700 space-y-1">
                    <div>â€¢ í† ì–‘ìŠµë„ 45% â†’ ëª©í‘œ 65%</div>
                    <div>â€¢ ì˜ˆìƒ ì™„ë£Œ: 45ë¶„ í›„</div>
                    <div>â€¢ ë‹¤ìŒ ìŠ¤ì¼€ì¤„: ì˜¤í›„ 6ì‹œ</div>
                  </div>
                </div>
                
                <div className="flex gap-2">
                  <button className="flex-1 py-2 bg-blue-600 text-white rounded text-sm font-medium">
                    ìˆ˜ë™ ì œì–´
                  </button>
                  <button className="flex-1 py-2 bg-gray-200 text-gray-700 rounded text-sm font-medium">
                    ì¼ì‹œ ì¤‘ì§€
                  </button>
                </div>
              </div>
              
              <div className="p-4 border border-green-200 rounded-lg">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className="text-2xl">ğŸŒ¬ï¸</div>
                    <div>
                      <div className="font-bold text-green-800">ìŠ¤ë§ˆíŠ¸ í™˜ê¸° ì‹œìŠ¤í…œ</div>
                      <div className="text-sm text-gray-600">ì˜¨ì‹¤ ìë™ í™˜ê¸°</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 bg-yellow-400 rounded-full"></div>
                    <span className="text-sm text-yellow-600">ëŒ€ê¸°ì¤‘</span>
                  </div>
                </div>
                
                <div className="space-y-3 mb-4">
                  <div className="flex justify-between text-sm">
                    <span>ì˜¨ì‹¤ ì˜¨ë„:</span>
                    <span className="font-bold">{(sensors.airTemp + 2)?.toFixed(1)}Â°C</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span>í™˜ê¸°ì°½ ê°œë°©:</span>
                    <span className="font-bold">35%</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span>íŒ¬ ê°€ë™ë¥ :</span>
                    <span className="font-bold">0% (ëŒ€ê¸°)</span>
                  </div>
                </div>
                
                <div className="bg-green-50 rounded p-3 mb-4">
                  <div className="font-medium text-green-800 mb-2">âš™ï¸ ìë™ ì„¤ì •</div>
                  <div className="text-sm text-green-700 space-y-1">
                    <div>â€¢ ì‘ë™ ì˜¨ë„: 28Â°C ì´ìƒ</div>
                    <div>â€¢ í˜„ì¬ ì˜¨ë„: {(sensors.airTemp + 2)?.toFixed(1)}Â°C</div>
                    <div>â€¢ ìƒíƒœ: ì„ê³„ì  ê·¼ì ‘</div>
                  </div>
                </div>
                
                <div className="flex gap-2">
                  <button className="flex-1 py-2 bg-green-600 text-white rounded text-sm font-medium">
                    ì¦‰ì‹œ í™˜ê¸°
                  </button>
                  <button className="flex-1 py-2 bg-gray-200 text-gray-700 rounded text-sm font-medium">
                    ì„¤ì • ë³€ê²½
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* P-5. AI ë¶„ì„ íƒ­ */}
      {activeTab === 'analysis' && (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-lg p-5">
            <h3 className="font-bold text-lg mb-4">ğŸ¥ ë†ì¥ ì¢…í•© ê±´ê°•ë„ ë¶„ì„</h3>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
              <div className="text-center p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl">
                <div className="text-4xl font-bold text-green-600 mb-2">89ì </div>
                <div className="text-green-800 font-medium">ì „ì²´ ê±´ê°•ë„</div>
                <div className="text-sm text-green-600 mt-1">ë§¤ìš° ì–‘í˜¸</div>
                
                <div className="mt-4 relative w-16 h-16 mx-auto">
                  <div className="absolute inset-0 rounded-full border-4 border-green-200"></div>
                  <div className="absolute inset-0 rounded-full border-4 border-green-500 border-t-transparent transform -rotate-90"></div>
                </div>
              </div>
              
              <div className="text-center p-6 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl">
                <div className="text-4xl font-bold text-blue-600 mb-2">92ì </div>
                <div className="text-blue-800 font-medium">ì‘ë¬¼ ì„±ì¥ë„</div>
                <div className="text-sm text-blue-600 mt-1">ìš°ìˆ˜</div>
                
                <div className="mt-4 space-y-2 text-xs">
                  <div className="flex justify-between">
                    <span>ë²¼:</span>
                    <span className="font-bold">95ì </span>
                  </div>
                  <div className="flex justify-between">
                    <span>ë°°ì¶”:</span>
                    <span className="font-bold">88ì </span>
                  </div>
                  <div className="flex justify-between">
                    <span>í† ë§ˆí† :</span>
                    <span className="font-bold">93ì </span>
                  </div>
                </div>
              </div>
              
              <div className="text-center p-6 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl">
                <div className="text-4xl font-bold text-orange-600 mb-2">76ì </div>
                <div className="text-orange-800 font-medium">í™˜ê²½ ì í•©ë„</div>
                <div className="text-sm text-orange-600 mt-1">ê°œì„  í•„ìš”</div>
                
                <div className="mt-4 space-y-2 text-xs">
                  <div className="flex justify-between">
                    <span>ê¸°ì˜¨:</span>
                    <span className="font-bold text-red-600">68ì </span>
                  </div>
                  <div className="flex justify-between">
                    <span>ìŠµë„:</span>
                    <span className="font-bold text-green-600">85ì </span>
                  </div>
                  <div className="flex justify-between">
                    <span>í† ì–‘:</span>
                    <span className="font-bold text-green-600">88ì </span>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div className="font-semibold text-blue-800 mb-3">ğŸ¤– AI ê°œì„  ì œì•ˆ</div>
              <div className="space-y-2 text-sm">
                <div className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                  <div>
                    <div className="font-medium text-red-700">ê¸´ê¸‰: í­ì—¼ ëŒ€ì‘ ê°•í™”</div>
                    <div className="text-red-600">ì°¨ê´‘ ì‹œì„¤ í™•ì¶© ë° ê´€ìˆ˜ëŸ‰ 50% ì¦ëŸ‰ ê¶Œì¥</div>
                  </div>
                </div>
                <div className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                  <div>
                    <div className="font-medium text-yellow-700">ì¤‘ìš”: í† ì–‘ pH ì¡°ì •</div>
                    <div className="text-yellow-600">2êµ¬ì—­ pH 6.8 â†’ 6.5 ì¡°ì •ìœ¼ë¡œ ë°°ì¶” í’ˆì§ˆ ê°œì„ </div>
                  </div>
                </div>
                <div className="flex items-start gap-2">
                  <div className="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                  <div>
                    <div className="font-medium text-green-700">ê¶Œì¥: ì˜ì–‘ë¶„ ë³´ì¶©</div>
                    <div className="text-green-600">ì§ˆì†Œ ì¶”ê°€ ì‹œìš©ìœ¼ë¡œ ë²¼ ìˆ˜í™•ëŸ‰ 5% ì¦ëŒ€ ê°€ëŠ¥</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// 1ë¶€ì—ì„œ ë°›ëŠ” ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸ì— ì¶”ê°€í•  í™”ë©´ë“¤
const CompleteFarmingAppPart2 = () => {
  // 1ë¶€ì—ì„œ ì´ë¯¸ ì •ì˜ëœ ìƒíƒœë“¤ì„ ì‚¬ìš©
  const [currentScreen, setCurrentScreen] = useState('calendar');
  const [voiceEnabled, setVoiceEnabled] = useState(false);
  
  // ì„ì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” 1ë¶€ì—ì„œ ë°›ìŒ)
  const mockData = {
    livingSeasons: {
      traditional: { name: 'ì²˜ì„œ', date: '8ì›” 23ì¼', expectedTemp: 28 },
      living: { name: 'ì‹¤ì§ˆì²˜ì„œ', date: '8ì›” 26ì¼', actualTemp: 31.2, adjustment: '+3ì¼' }
    },
    weatherHistory: [],
    crops: [],
    farmData: { 
      totalArea: 5000,
      fields: [
        { 
          id: 'field001', name: '1êµ¬ì—­ ë…¼', crop: 'rice', variety: 'ì¶”ì²­', area: 3000,
          coordinates: { lat: 36.4645, lng: 127.1204 },
          plantingDate: '2024-05-15', expectedHarvest: '2024-10-15',
          soilType: 'ì¶©ì í† ', drainageType: 'ë°°ìˆ˜ì–‘í˜¸', lastSoilTest: '2024-03-15'
        }
      ]
    },
    sensors: {
      soilMoisture: 45, soilTemp: 24.8, airTemp: 32.4, humidity: 68, ph: 6.2,
      nitrogen: 120, phosphorus: 65, potassium: 180, co2: 420, 
      lightIntensity: 45000, windSpeed: 5.2, leafWetness: 3.5
    },
    devices: [
      { id: 1, name: 'ê´€ìˆ˜ì‹œìŠ¤í…œ', type: 'irrigation', status: 'active', autoMode: true, battery: 85 }
    ],
    yieldPredictions: {},
    pestAlerts: [],
    weatherData: { current: { temp: 32.4 } }
  };

  const speakText = (text) => {
    if (voiceEnabled && 'speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ko-KR';
      speechSynthesis.speak(utterance);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ìƒë‹¨ í—¤ë” */}
      <div className="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="text-2xl">ğŸŒ¾</div>
            <div>
              <h1 className="text-xl font-bold">ìŠ¤ë§ˆíŠ¸ ìƒí™œì ˆê¸°</h1>
              <p className="text-xs opacity-90">2ë¶€: ì ˆê¸°ë‹¬ë ¥ + ë†ì¥ê´€ë¦¬</p>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            <button 
              onClick={() => setVoiceEnabled(!voiceEnabled)}
              className={`p-2 rounded ${voiceEnabled ? 'bg-green-500' : 'bg-green-700'}`}
            >
              ğŸ”Š
            </button>
            <div className="text-xs text-center">
              <div>Gold</div>
              <div className="text-yellow-200">3450P</div>
            </div>
          </div>
        </div>
      </div>

      {/* ë©”ì¸ ì½˜í…ì¸  */}
      <div className="pb-20">
        {currentScreen === 'calendar' && (
          <SeasonCalendarScreen 
            livingSeasons={mockData.livingSeasons}
            weatherHistory={mockData.weatherHistory}
            crops={mockData.crops}
            voiceEnabled={voiceEnabled}
            speakText={speakText}
          />
        )}
        {currentScreen === 'farm' && (
          <ComprehensiveFarmScreen
            farmData={mockData.farmData}
            sensors={mockData.sensors}
            devices={mockData.devices}
            crops={mockData.crops}
            yieldPredictions={mockData.yieldPredictions}
            pestAlerts={mockData.pestAlerts}
            weatherData={mockData.weatherData}
            voiceEnabled={voiceEnabled}
            speakText={speakText}
          />
        )}
      </div>

      {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 shadow-lg">
        <div className="flex justify-around">
          <button className="flex flex-col items-center p-2 text-gray-400">
            <div className="text-2xl">ğŸ </div>
            <span className="text-xs mt-1">í™ˆ</span>
          </button>
          <button
            onClick={() => setCurrentScreen('calendar')}
            className={`flex flex-col items-center p-2 ${
              currentScreen === 'calendar' ? 'text-green-600' : 'text-gray-400'
            }`}
          >
            <div className="text-2xl">ğŸ“…</div>
            <span className="text-xs mt-1">ì ˆê¸°ë‹¬ë ¥</span>
          </button>
          <button
            onClick={() => setCurrentScreen('farm')}
            className={`flex flex-col items-center p-2 ${
              currentScreen === 'farm' ? 'text-green-600' : 'text-gray-400'
            }`}
          >
            <div className="text-2xl">ğŸ—ºï¸</div>
            <span className="text-xs mt-1">ë†ì¥ê´€ë¦¬</span>
          </button>
          <button className="flex flex-col items-center p-2 text-gray-400">
            <div className="text-2xl">ğŸ‘¥</div>
            <span className="text-xs mt-1">ì»¤ë®¤ë‹ˆí‹°</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default CompleteFarmingAppPart2;
            </div>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span>í˜„ì¬:</span>
                <span className="font-bold text-green-700">
                  {livingSeasons?.traditional?.name || 'ì²˜ì„œ'}
                </span>
              </div>
              <div className="flex justify-between">
                <span>ë‚ ì§œ:</span>
                <span>{livingSeasons?.traditional?.date || '8ì›” 23ì¼'}</span>
              </div>
              <div className="flex justify-between">
                <span>ì˜ˆìƒê¸°ì˜¨:</span>
                <span>{livingSeasons?.traditional?.expectedTemp || 28}Â°C</span>
              </div>
            </div>
          </div>
          
          <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <div className="flex items-center gap-2 mb-3">
              <div className="text-2xl">ğŸŒ¡ï¸</div>
              <div>
                <div className="font-bold text-blue-800">ìƒí™œì ˆê¸°</div>
                <div className="text-sm text-blue-600">ì‹¤ì œ ê¸°ì˜¨ ê¸°ì¤€</div>
              </div>
            </div>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span>í˜„ì¬:</span>
                <span className="font-bold text-blue-700">
                  {livingSeasons?.living?.name || 'ì‹¤ì§ˆì²˜ì„œ'}
                </span>
              </div>
              <div className="flex justify-between">
                <span>ë‚ ì§œ:</span>
                <span>{livingSeasons?.living?.date || '8ì›” 26ì¼'}</span>
              </div>
              <div className="flex justify-between">
                <span>ì‹¤ì œê¸°ì˜¨:</span>
                <span>{livingSeasons?.living?.actualTemp?.toFixed(1) || 31.2}Â°C</span>
              </div>
              <div className="flex justify-between">
                <span>ì¡°ì •:</span>
                <span className="font-bold text-red-600">
                  {livingSeasons?.living?.adjustment || '+3ì¼'}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div className="font-semibold text-yellow-800 mb-2">ğŸ“ˆ ì ˆê¸° ë³€í™” ë¶„ì„</div>
          <div className="text-sm text-yellow-700 space-y-1">
            <div>â€¢ ì˜¬í•´ í‰ê·  ì ˆê¸° ì§€ì—°: +3.2ì¼ (ì‘ë…„ ëŒ€ë¹„ +0.8ì¼)</div>
            <div>â€¢ ì£¼ìš” ì›ì¸: ì´ìƒ ê³ ì˜¨ í˜„ìƒ ì§€ì†</div>
            <div>â€¢ ë†ì‘ì—… ì˜í–¥: ë²¼ ìƒìœ¡ê¸° ì—°ì¥, ìˆ˜í™•ì‹œê¸° ì¡°ì • í•„ìš”</div>
          </div>
        </div>
      </div>

      {/* O-3. ì›”ë³„ ì ˆê¸° ë‹¬ë ¥ */}
      <div className="bg-white rounded-xl shadow-lg p-5">
        <h3 className="font-bold text-lg mb-4">
          ğŸ“† {selectedMonth + 1}ì›” ë†ì—… ë‹¬ë ¥
        </h3>
        
        <div className="mb-6">
          {viewMode === 'traditional' || viewMode === 'combined' ? (
            <div className="mb-4 p-3 bg-green-50 rounded-lg">
              <div className="font-semibold text-green-800 mb-1">ğŸ›ï¸ ì „í†µì ˆê¸°</div>
              <div className="text-sm text-green-700">
                {seasonalCalendar[selectedMonth]?.traditional || 'í•´ë‹¹ ì›” ì ˆê¸° ì—†ìŒ'}
              </div>
            </div>
          ) : null}
          
          {viewMode === 'living' || viewMode === 'combined' ? (
            <div className="mb-4 p-3 bg-blue-50 rounded-lg">
              <div className="font-semibold text-blue-800 mb-1">ğŸŒ¡ï¸ ìƒí™œì ˆê¸°</div>
              <div className="text-sm text-blue-700">
                {seasonalCalendar[selectedMonth]?.living || 'í•´ë‹¹ ì›” ì ˆê¸° ì—†ìŒ'}
              </div>
            </div>
          ) : null}
        </div>
        
        <div className="space-y-4">
          {Object.entries(cropCalendar).map(([cropType, calendar]) => {
            const cropInfo = calendar[selectedMonth];
            if (!cropInfo) return null;
            
            return (
              <div key={cropType} className="p-4 border border-gray-200 rounded-lg">
                <div className="flex items-center gap-3 mb-3">
                  <div className="text-2xl">
                    {cropType === 'rice' ? 'ğŸŒ¾' : 'ğŸ¥¬'}
                  </div>
                  <div>
                    <div className="font-bold">
                      {cropType === 'rice' ? 'ë²¼' : 'ë°°ì¶”'} ë†ì‘ì—…
                    </div>
                    <div className="text-sm text-gray-600">{selectedMonth + 1}ì›” ê¶Œì¥ ì‘ì—…</div>
                  </div>
                </div>
                <div className="bg-gray-50 p-3 rounded text-sm">
                  {cropInfo}
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* O-4. ê¸°ìƒ íŒ¨í„´ ë¶„ì„ */}
      <div className="bg-white rounded-xl shadow-lg p-5">
        <h3 className="font-bold text-lg mb-4">ğŸŒ¡ï¸ ì›”ë³„ ê¸°ìƒ íŒ¨í„´ ë¶„ì„</h3>
        
        <div className="grid grid-cols-2 gap-4 mb-4">
          <div className="p-3 bg-red-50 rounded-lg">
            <div className="font-semibold text-red-800 mb-2">í‰ê·  ê¸°ì˜¨ ë³€í™”</div>
            <div className="text-sm text-red-700">
              <div>í‰ë…„: 24.5Â°C</div>
              <div>ì˜¬í•´: 27.8Â°C (+3.3Â°C)</div>
              <div className="font-bold text-red-600">ìƒìŠ¹ ì¶”ì„¸</div>
            </div>
          </div>
          
          <div className="p-3 bg-blue-50 rounded-lg">
            <div className="font-semibold text-blue-800 mb-2">ê°•ìˆ˜ íŒ¨í„´</div>
            <div className="text-sm text-blue-700">
              <div>í‰ë…„: 195mm</div>
              <div>ì˜¬í•´: 142mm (-27%)</div>
              <div className="font-bold text-blue-600">ê°€ë­„ ê²½í–¥</div>
            </div>
          </div>
        </div>
        
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
          <div className="font-semibold text-orange-800 mb-2">âš ï¸ ë†ì—… ì˜í–¥ ì˜ˆì¸¡</div>
          <div className="text-sm text-orange-700 space-y-1">
            <div>â€¢ ê³ ì˜¨ìœ¼ë¡œ ì¸í•œ ìƒìœ¡ê¸°ê°„ ì—°ì¥</div>
            <div>â€¢ ê´€ìˆ˜ëŸ‰ ì¦ê°€ í•„ìš” (í‰ë…„ ëŒ€ë¹„ +40%)</div>
            <div>â€¢ ë³‘í•´ì¶© ë°œìƒ ìœ„í—˜ ì¦ê°€</div>
            <div>â€¢ ìˆ˜í™•ì‹œê¸° 2-3ì£¼ ì§€ì—° ì˜ˆìƒ</div>
          </div>
        </div>
      </div>
    </div>
  );
};

// P. ë†ì¥ ê´€ë¦¬ í†µí•© í™”ë©´ ì»´í¬ë„ŒíŠ¸
const ComprehensiveFarmScreen = ({ 
  farmData, 
  sensors, 
  devices, 
  crops, 
  yieldPredictions,
  pestAlerts,
  weatherData,
  voiceEnabled, 
  speakText 
}) => {
  const [selectedField, setSelectedField] = useState(null);
  const [activeTab, setActiveTab] = useState('overview');
  const [mapView, setMapView] = useState('satellite');

  return (
    <div className="p-4 space-y-6 pb-24">
      {/* P-1. ë†ì¥ ê°œìš” í—¤ë” */}
      <div className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl p-5">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h2 className="text-2xl font-bold">ğŸï¸ ìŠ¤ë§ˆíŠ¸ ë†ì¥ ê´€ë¦¬</h2>
            <p className="opacity-90">ì´ ë©´ì : {farmData.totalArea?.toLocaleString()}í‰ | 3ê°œ êµ¬ì—­</p>
          </div>
          <div className="text-right">
            <div className="text-sm opacity-80">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</div>
            <div className="flex items-center gap-2 mt-1">
              <div className="w-2 h-2 bg-green-300 rounded-full animate-pulse"></div>
              <span className="text-sm">ì„¼ì„œ ì •ìƒ</span>
            </div>
          </div>
        </div>
        
        <div className="flex gap-2">
          {[
            { key: 'overview', label: 'ì „ì²´í˜„í™©', icon: 'ğŸ—ºï¸' },
            { key: 'sensors', label: 'ì„¼ì„œë°ì´í„°', icon: 'ğŸ“Š' },
            { key: 'devices', label: 'ì¥ë¹„ì œì–´', icon: 'âš™ï¸' },
            { key: 'analysis', label: 'AIë¶„ì„', icon: 'ğŸ¤–' }
          ].map(tab => (
            <button
              key={tab.key}
              onClick={() => setActiveTab(tab.key)}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                activeTab === tab.key
                  ? 'bg-white text-emerald-600'
                  : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
              }`}
            >
              {tab.icon} {tab.label}
            </button>
          ))}
        </div>
      </div>

      {/* P-2. ì „ì²´ í˜„í™© íƒ­ */}
      {activeTab === 'overview' && (
        <>
          <div className="bg-white rounded-xl shadow-lg p-5">
            <div className="flex items-center justify-between mb-4">
              <h3 className="font-bold text-lg">ğŸ—ºï¸ GPS ë†ì¥ ì§€ë„</h3>
              <div className="flex gap-2">
                {['satellite', 'terrain', 'hybrid'].map(view => (
                  <button
                    key={view}
                    onClick={() => setMapView(view)}
                    className={`px-3 py-1 rounded text-sm ${
                      mapView === view
                        ? 'bg-emerald-600 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    {view === 'satellite' ? 'ìœ„ì„±' : view === 'terrain' ? 'ì§€í˜•' : 'í˜¼í•©'}
                  </button>
                ))}
              </div>
            </div>
            
            <div className="relative bg-green-50 h-64 rounded-lg border-2 border-green-200 mb-4 overflow-hidden">
              <div className="absolute inset-0 opacity-20">
                <div className="w-full h-full bg-gradient-to-br from-green-200 to-blue-200"></div>
              </div>
              
              {farmData.fields?.map((field, idx) => {
                const positions = [
                  { top: '10%', left: '10%', width: '35%', height: '40%' },
                  { top: '15%', right: '10%', width: '30%', height: '35%' },
                  { bottom: '10%', left: '20%', width: '25%', height: '30%' }
                ];
                
                const position = positions[idx] || positions[0];
                const statusColors = {
                  good: 'border-green-400 bg-green-100',
                  warning: 'border-yellow-400 bg-yellow-100',
                  danger: 'border-red-400 bg-red-100'
                };
                
                return (
                  <div
                    key={field.id}
                    className={`absolute border-2 rounded-lg p-3 cursor-pointer hover:shadow-lg transition-all ${
                      statusColors[field.status || 'good']
                    } ${selectedField?.id === field.id ? 'ring-2 ring-blue-400' : ''}`}
                    style={position}
                    onClick={() => {
                      setSelectedField(field);
                      voiceEnabled && speakText(`${field.name}ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤`);
                    }}
                  >
                    <div className="font-bold text-sm">{field.name}</div>
                    <div className="text-xs text-gray-600 mb-2">
                      {field.crop === 'rice' ? 'ğŸŒ¾ ë²¼' : field.crop === 'cabbage' ? 'ğŸ¥¬ ë°°ì¶”' : 'ğŸ… í† ë§ˆí† '}
                      ({field.area?.toLocaleString()}í‰)
                    </div>
                    
                    <div className="text-xs space-y-1">
                      <div className="flex justify-between">
                        <span>ìŠµë„:</span>
                        <span className="font-bold">
                          {idx === 0 ? sensors.soilMoisture?.toFixed(0) : 
                           idx === 1 ? (sensors.soilMoisture - 10)?.toFixed(0) : 
                           (sensors.soilMoisture + 5)?.toFixed(0)}%
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span>ì˜¨ë„:</span>
                        <span className="font-bold">
                          {idx === 0 ? sensors.soilTemp?.toFixed(1) : 
                           idx === 1 ? (sensors.soilTemp - 2)?.toFixed(1) : 
                           (sensors.soilTemp + 1)?.toFixed(1)}Â°C
                        </span>
                      </div>
                    </div>
                    
                    <div className="text-xs text-gray-500 mt-2">
                      ğŸ“ {field.coordinates?.lat.toFixed(4)}, {field.coordinates?.lng.toFixed(4)}
                    </div>
                  </div>
                );
              })}
              
              <div className="absolute top-4 right-4 bg-white bg-opacity-90 rounded p-2 text-xs">
                <div className="font-semibold mb-1">ìƒíƒœ ë²”ë¡€</div>
                <div className="flex items-center gap-1 mb-1">
                  <div className="w-3 h-3 bg-green-400 rounded"></div>
                  <span>ì–‘í˜¸</span>
                </div>
                <div className="flex items-center gap-1 mb-1">
                  <div className="w-3 h-3 bg-yellow-400 rounded"></div>
                  <span>ì£¼ì˜</span>
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-3 h-3 bg-red-400 rounded"></div>
                  <span>ìœ„í—˜</span>
                </div>
              </div>
            </div>
            
            {selectedField && (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div className="flex items-center justify-between mb-3">
                  <h4 className="font-bold text-blue-800">{selectedField.name} ìƒì„¸ ì •ë³´</h4>
                  <button 
                    onClick={() => setSelectedField(null)}
                    className="text-blue-600 hover:text-blue-800"
                  >
                    âœ•
                  </button>
                </div>
                
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <div className="space-y-2">
                      <div><strong>ì‘ë¬¼:</strong> {selectedField.crop === 'rice' ? 'ë²¼' : selectedField.crop === 'cabbage' ? 'ë°°ì¶”' : 'í† ë§ˆí† '}</div>
                      <div><strong>í’ˆì¢…:</strong> {selectedField.variety}</div>
                      <div><strong>ë©´ì :</strong> {selectedField.area?.toLocaleString()}í‰</div>
                      <div><strong>íŒŒì¢…ì¼:</strong> {selectedField.plantingDate}</div>
                    </div>
                  </div>
                  <div>
                    <div className="space-y-2">
                      <div><strong>í† ì–‘:</strong> {selectedField.soilType}</div>
                      <div><strong>ë°°ìˆ˜:</strong> {selectedField.drainageType}</div>
                      <div><strong>í† ì–‘ê²€ì‚¬:</strong> {selectedField.lastSoilTest}</div>
                      <div><strong>ìˆ˜í™•ì˜ˆì •:</strong> {selectedField.expectedHarvest}</div>
                    </div>
                  </div>
                </div>
                
                {yieldPredictions[selectedField.id] && (
                  <div className="mt-3 p-3 bg-green-50 border border-green-200 rounded">
                    <div className="font-semibold text-green-800 mb-2">ğŸ¯ AI ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡</div>
                    <div className="grid grid-cols-2 gap-3 text-sm">
                      <div>
                        <div>ì˜ˆìƒ ìˆ˜í™•ëŸ‰: <strong>{yieldPredictions[selectedField.id].predicted?.toLocaleString()}{yieldPredictions[selectedField.id].unit}</strong></div>
                        <div>ì‹ ë¢°ë„: {yieldPredictions[selectedField.id].confidence}%</div>
                      </div>
                      <div className="text-xs">
                        <div>ë‚ ì”¨ ì˜í–¥: {yieldPredictions[selectedField.id].factors?.weather}%</div>
                        <div>í† ì–‘ ì ìˆ˜: {yieldPredictions[selectedField.id].factors?.soil}ì </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {farmData.fields?.map((field, idx) => {
              const crop = crops.find(c => c.fieldId === field.id);
              
              return (
                <div key={field.id} className="bg-white rounded-lg shadow-md p-4">
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-2">
                      <div className="text-xl">
                        {field.crop === 'rice' ? 'ğŸŒ¾' : field.crop === 'cabbage' ? 'ğŸ¥¬' : 'ğŸ…'}
                      </div>
                      <div>
                        <div className="font-bold">{field.name}</div>
                        <div className="text-sm text-gray-600">{field.area?.toLocaleString()}í‰</div>
                      </div>
                    </div>
                    <div className={`w-3 h-3 rounded-full ${
                      field.status === 'good' ? 'bg-green-400' : 
                      field.status === 'warning' ? 'bg-yellow-400' : 'bg-red-400'
                    }`}></div>
                  </div>
                  
                  {crop && (
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between">
                        <span>í˜„ì¬ ë‹¨ê³„:</span>
                        <span className="font-medium">{crop.growthStage?.current?.stage}</span>
                      </div>
                      <div className="flex justify-between">
                        <span>GDD ì§„í–‰ë¥ :</span>
                        <span className="font-medium">{crop.growthStage?.overallProgress?.toFixed(0)}%</span>
                      </div>
                      <div className="flex justify-between">
                        <span>ë‹¤ìŒ ë‹¨ê³„ê¹Œì§€:</span>
                        <span className="font-medium">D-{crop.growthStage?.estimatedDaysToNext || '?'}</span>
                      </div>
                    </div>
                  )}
                  
                  <div className="mt-3 pt-3 border-t border-gray-200">
                    <button className="w-full text-center text-blue-600 hover:text-blue-800 text-sm font-medium">
                      ìƒì„¸ ê´€ë¦¬ â†’
                    </button>
                  </div>
                </div>
              );
            })}
          </div>
        </>
      )}

      {/* P-3. ì„¼ì„œ ë°ì´í„° íƒ­ */}
      {activeTab === 'sensors' && (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-lg p-5">
            <h3 className="font-bold text-lg mb-4">ğŸ“Š ì‹¤ì‹œê°„ ì„¼ì„œ ëª¨ë‹ˆí„°ë§</h3>
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div className="p-4 bg-blue-50 rounded-lg text-center">
                <div className="text-2xl mb-2">ğŸŒ¡ï¸</div>
                <div className="font-bold text-xl text-red-600">{sensors.airTemp?.toFixed(1)}Â°C</div>
                <div className="text-sm text-gray-600">ê¸°ì˜¨</div>
                <div className="text-xs text-red-500">ì²´ê° {(sensors.airTemp + 3)?.toFixed(1)}Â°C</div>
              </div>
              
              <div className="p-4 bg-cyan-50 rounded-lg text-center">
                <div className="text-2xl mb-2">ğŸ’§</div>
                <div className="font-bold text-xl text-blue-600">{sensors.humidity?.toFixed(0)}%</div>
                <div className="text-sm text-gray-600">ëŒ€ê¸°ìŠµë„</div>
                <div className="text-xs text-blue-500">í† ì–‘ {sensors.soilMoisture?.toFixed(0)}%</div>
              </div>
              
              <div className="p-4 bg-green-50 rounded-lg text-center">
                <div className="text-2xl mb-2">âš—ï¸</div>
                <div className="font-bold text-xl text-green-600">{sensors.ph?.toFixed(1)}</div>
                <div className="text-sm text-gray-600">í† ì–‘ pH</div>
                <div className="text-xs text-green-500">ì ì • ë²”ìœ„</div>
              </div>
              
              <div className="p-4 bg-yellow-50 rounded-lg text-center">
                <div className="text-2xl mb-2">â˜€ï¸</div>
                <div className="font-bold text-xl text-yellow-600">{(sensors.lightIntensity/1000)?.toFixed(0)}</div>
                <div className="text-sm text-gray-600">ì¡°ë„ (klx)</div>
                <div className="text-xs text-yellow-500">ì¶©ë¶„í•¨</div>
              </div>
import React, { useState, useEffect, useCallback } from 'react';
import { Calendar, Thermometer, CloudRain, Sun, Wind, AlertTriangle, TrendingUp, MapPin, Clock, Bell, Droplets, Eye, Activity, Settings, Camera, Bug, Leaf, Calculator, Map, BarChart3, Timer, Zap, CheckCircle, Users, MessageCircle, Star, Award, BookOpen, Phone, Volume2, Wifi, WifiOff, DollarSign, Heart, Share, Filter, Search, Send, ThumbsUp, AlertCircle, TrendingDown, ArrowUp, ArrowDown, Shield, Video, Headphones, Download, Wrench, Battery, Cpu, Database, Navigation, Smartphone, Monitor, Upload, Save, RefreshCw, Play, Pause, Home, Menu, X, Plus, Edit3, Trash2, FileText, Image, Mic, MicOff, Speaker, Target, Scissors, Sprout, Wheat, Apple, MessageSquare, UserCheck, Verified, Package, Truck, CreditCard, ChevronDown, ChevronUp, RotateCcw, Power, HelpCircle } from 'lucide-react';

// í•µì‹¬ ë°ì´í„°ë² ì´ìŠ¤ ë° ì•Œê³ ë¦¬ì¦˜ (1ë¶€ì—ì„œ)
const CROP_DATABASE = {
  rice: {
    name: 'ë²¼',
    baseTemp: 10,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì¤€ë¹„', 'ë…¼ ì •ë¦¬'], duration: 7 },
      { stage: 'ë°œì•„', gdd: 120, tasks: ['ë¬¼ ê´€ë¦¬', 'ì˜¨ë„ ì¡°ì ˆ'], duration: 14 },
      { stage: 'ë¶„ì–¼', gdd: 400, tasks: ['ì œì´ˆ', 'ì¶”ë¹„ì‹œìš©'], duration: 30 },
      { stage: 'ìˆ˜ì‰', gdd: 800, tasks: ['ë¬¼ ê¹Šì´ ì¡°ì ˆ', 'ë³‘í•´ì¶© ë°©ì œ'], duration: 35 },
      { stage: 'ì¶œìˆ˜', gdd: 1200, tasks: ['ìˆ˜ë¶„ ê´€ë¦¬', 'ì¡°ë¥˜ ë°©ì œ'], duration: 20 },
      { stage: 'ì„±ìˆ™', gdd: 1600, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ê±´ì¡° ì¤€ë¹„'], duration: 30 }
    ],
    expectedYield: { min: 1.5, max: 2.2, unit: 'kg/í‰' }
  },
  cabbage: {
    name: 'ë°°ì¶”',
    baseTemp: 5,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì†Œë…', 'ìƒí†  ì¤€ë¹„'], duration: 3 },
      { stage: 'ë°œì•„', gdd: 80, tasks: ['ì˜¨ë„ ê´€ë¦¬', 'ìŠµë„ ì¡°ì ˆ'], duration: 7 },
      { stage: 'ë³¸ì—½', gdd: 200, tasks: ['ê°„ì‹', 'ì›ƒê±°ë¦„'], duration: 21 },
      { stage: 'ê²°êµ¬ì‹œì‘', gdd: 500, tasks: ['ì¶©ë¶„í•œ ê´€ìˆ˜', 'í† ì–‘ ê´€ë¦¬'], duration: 20 },
      { stage: 'ê²°êµ¬ì™„ì„±', gdd: 800, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ì €ì¥ ì¤€ë¹„'], duration: 15 }
    ],
    expectedYield: { min: 15, max: 25, unit: 'kg/í‰' }
  }
};

const calculateLivingSeason = (region, currentDate, weatherHistory) => {
  const traditionalSeasons = [
    { name: 'ì²˜ì„œ', date: '2024-08-23', temp: 28 },
    { name: 'ë°±ë¡œ', date: '2024-09-07', temp: 25 },
    { name: 'ì¶”ë¶„', date: '2024-09-22', temp: 20 }
  ];

  const currentSeason = traditionalSeasons.find(season => {
    const seasonDate = new Date(season.date);
    return Math.abs(currentDate - seasonDate) < 15 * 24 * 60 * 60 * 1000;
  });

  if (!currentSeason) return null;

  const recentAvgTemp = weatherHistory.slice(-7).reduce((sum, day) => sum + day.avgTemp, 0) / 7;
  const tempDiff = recentAvgTemp - currentSeason.temp;
  const dayAdjustment = Math.round(tempDiff / 2);
  
  const livingSeasonDate = new Date(currentSeason.date);
  livingSeasonDate.setDate(livingSeasonDate.getDate() + dayAdjustment);

  return {
    traditional: {
      name: currentSeason.name,
      date: currentSeason.date,
      expectedTemp: currentSeason.temp
    },
    living: {
      name: `ì‹¤ì§ˆ${currentSeason.name}`,
      date: livingSeasonDate.toISOString().split('T')[0],
      actualTemp: recentAvgTemp,
      adjustment: dayAdjustment > 0 ? `+${dayAdjustment}ì¼` : `${dayAdjustment}ì¼`
    }
  };
};

const calculateRealGDD = (maxTemp, minTemp, baseTemp = 10) => {
  const avgTemp = (maxTemp + minTemp) / 2;
  return Math.max(0, avgTemp - baseTemp);
};

const analyzeWeatherRisks = (weatherHistory) => {
  const risks = [];
  const hotDays = weatherHistory.slice(-7).filter(day => day.maxTemp >= 33).length;
  const extremeHotDays = weatherHistory.slice(-7).filter(day => day.maxTemp >= 35).length;
  
  if (extremeHotDays >= 3) {
    risks.push({
      type: 'HEATWAVE_EXTREME',
      severity: 'critical',
      title: 'ê·¹í•œí­ì—¼ ê²½ë³´',
      message: `${extremeHotDays}ì¼ ì—°ì† 35Â°C ì´ìƒ, ì‘ë¬¼ ê³ ì‚¬ ìœ„í—˜`,
      actions: [
        'ê¸´ê¸‰ ê´€ìˆ˜ ì‹œìŠ¤í…œ ê°€ë™',
        'ì°¨ê´‘ë§ 100% ì„¤ì¹˜',
        'ì˜¤ì „ 6-9ì‹œì—ë§Œ ì‘ì—…'
      ],
      autoActions: ['START_EMERGENCY_IRRIGATION', 'DEPLOY_SHADE_NETS']
    });
  }

  return risks;
};

// ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
const CompleteFarmingAppFinal = () => {
  // ì „ì—­ ìƒíƒœ ê´€ë¦¬
  const [currentScreen, setCurrentScreen] = useState('home');
  const [isLoading, setIsLoading] = useState(false);
  const [isOffline, setIsOffline] = useState(false);
  const [voiceEnabled, setVoiceEnabled] = useState(false);
  const [notifications, setNotifications] = useState([]);
  const [showNotifications, setShowNotifications] = useState(false);
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  // ë†ì—… ë°ì´í„° ìƒíƒœ
  const [userProfile, setUserProfile] = useState({});
  const [farmData, setFarmData] = useState({});
  const [weatherData, setWeatherData] = useState({});
  const [weatherHistory, setWeatherHistory] = useState([]);
  const [crops, setCrops] = useState([]);
  const [sensors, setSensors] = useState({});
  const [devices, setDevices] = useState([]);
  const [alerts, setAlerts] = useState([]);
  const [livingSeasons, setLivingSeasons] = useState({});
  const [yieldPredictions, setYieldPredictions] = useState({});

  // ì»¤ë®¤ë‹ˆí‹° ê´€ë ¨ ìƒíƒœ
  const [activeChatRoom, setActiveChatRoom] = useState(null);
  const [liveConsultation, setLiveConsultation] = useState(null);
  const [newMessage, setNewMessage] = useState('');

  // ìŒì„± ì•ˆë‚´ ì‹œìŠ¤í…œ
  const speakText = useCallback((text) => {
    if (voiceEnabled && 'speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ko-KR';
      utterance.rate = 0.8;
      utterance.pitch = 1.1;
      speechSynthesis.speak(utterance);
    }
  }, [voiceEnabled]);

  // 1ë¶€: ë©”ì¸ í™ˆí™”ë©´ ì»´í¬ë„ŒíŠ¸
  const MainHomeScreen = () => {
    return (
      <div className="p-4 space-y-6 pb-24">
        {/* ê¸´ê¸‰ ì•Œë¦¼ ì„¹ì…˜ */}
        {alerts.length > 0 && (
          <div className="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl p-4 shadow-lg animate-pulse">
            <div className="flex items-center gap-2 text-red-800 font-bold mb-3">
              <AlertTriangle className="w-6 h-6" />
              ğŸš¨ ê¸´ê¸‰ ë†ì—… ì•Œë¦¼
            </div>
            {alerts.slice(0, 1).map((alert, idx) => (
              <div key={idx} className="mb-3">
                <div className="font-semibold text-red-700">{alert.title}</div>
                <div className="text-red-600 text-sm">{alert.message}</div>
                <div className="mt-2 flex gap-2">
                  <button 
                    onClick={() => speakText(alert.message)}
                    className="px-3 py-1 bg-red-500 text-white rounded text-xs"
                  >
                    ğŸ”Š ìŒì„±ë“£ê¸°
                  </button>
                  <button className="px-3 py-1 bg-blue-500 text-white rounded text-xs">
                    ğŸ¤– ìë™ì²˜ë¦¬
                  </button>
                </div>
              </div>
            ))}
          </div>
        )}

        {/* ìƒí™œì ˆê¸° í˜„í™© */}
        <div className="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Calendar className="w-6 h-6 text-green-600" />
            ì˜¤ëŠ˜ì˜ ìƒí™œì ˆê¸°
          </h3>
          
          <div className="grid grid-cols-2 gap-4 mb-4">
            <div className="text-center p-4 bg-green-100 rounded-lg">
              <div className="text-sm text-gray-600">ì „í†µì ˆê¸°</div>
              <div className="font-bold text-xl text-green-700">ì²˜ì„œ</div>
              <div className="text-xs text-gray-500">8ì›” 23ì¼</div>
              <div className="text-xs text-green-600 mt-1">ì˜ˆìƒ: 28Â°C</div>
            </div>
            <div className="text-center p-4 bg-blue-100 rounded-lg">
              <div className="text-sm text-gray-600">ìƒí™œì ˆê¸°</div>
              <div className="font-bold text-xl text-blue-700">ì‹¤ì§ˆì²˜ì„œ</div>
              <div className="text-xs text-gray-500">8ì›” 26ì¼ (+3ì¼)</div>
              <div className="text-xs text-blue-600 mt-1">ì‹¤ì œ: 31.2Â°C</div>
            </div>
          </div>
          
          <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
            <div className="font-semibold text-yellow-800 mb-1">ğŸ“Š ê¸°í›„ë³€í™” ì˜í–¥</div>
            <div className="text-sm text-yellow-700">
              í‰ë…„ë³´ë‹¤ 3ì¼ ëŠ¦ì€ ì ˆê¸°ë¡œ ìƒìœ¡ê¸°ê°„ì´ ì—°ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>

        {/* GDD ì§„í–‰ í˜„í™© */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <TrendingUp className="w-6 h-6 text-orange-600" />
            ìƒìœ¡ë„ì¼(GDD) í˜„í™©
          </h3>
          
          {crops.slice(0, 2).map((crop, idx) => (
            <div key={idx} className="mb-4 p-4 border border-gray-200 rounded-lg">
              <div className="flex justify-between items-center mb-3">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">{crop.type === 'rice' ? 'ğŸŒ¾' : 'ğŸ¥¬'}</span>
                  <div>
                    <div className="font-bold">{crop.name}</div>
                    <div className="text-sm text-gray-600">í˜„ì¬: {crop.stage}</div>
                  </div>
                </div>
                <div className="text-right">
                  <div className="font-bold text-green-600">{crop.progress}%</div>
                  <div className="text-xs text-gray-500">ì™„ë£Œ</div>
                </div>
              </div>
              
              <div className="bg-gray-200 rounded-full h-3 mb-2">
                <div 
                  className="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-1000"
                  style={{ width: `${crop.progress}%` }}
                ></div>
              </div>
              
              <div className="text-xs text-blue-600">
                ğŸ“‹ ë‹¤ìŒ ì‘ì—…: {crop.nextTask} (D-{crop.daysLeft})
              </div>
            </div>
          ))}
        </div>

        {/* ìŠ¤ë§ˆíŠ¸íŒœ ìƒíƒœ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Zap className="w-6 h-6 text-yellow-600" />
            ìŠ¤ë§ˆíŠ¸íŒœ ì œì–´ìƒíƒœ
          </h3>
          
          <div className="grid grid-cols-2 gap-4">
            <div className="p-3 bg-blue-50 rounded-lg">
              <div className="flex items-center gap-2 mb-2">
                <Droplets className="w-5 h-5 text-blue-600" />
                <span className="font-medium">ìë™ê´€ìˆ˜</span>
              </div>
              <div className="text-sm space-y-1">
                <div>ìƒíƒœ: <span className="text-green-600 font-bold">ê°€ë™ì¤‘</span></div>
                <div>í† ì–‘ìŠµë„: {sensors.soilMoisture?.toFixed(0)}%</div>
                <div>ëª©í‘œ: 65%</div>
              </div>
            </div>
            
            <div className="p-3 bg-green-50 rounded-lg">
              <div className="flex items-center gap-2 mb-2">
                <Wind className="w-5 h-5 text-green-600" />
                <span className="font-medium">í™˜ê¸°ì‹œìŠ¤í…œ</span>
              </div>
              <div className="text-sm space-y-1">
                <div>ìƒíƒœ: <span className="text-yellow-600 font-bold">ëŒ€ê¸°ì¤‘</span></div>
                <div>ì˜¨ë„: {sensors.airTemp?.toFixed(1)}Â°C</div>
                <div>ì„¤ì •: 28Â°C</div>
              </div>
            </div>
          </div>
        </div>

        {/* AI ì¶”ì²œ ì‘ì—… */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
            <Target className="w-6 h-6 text-purple-600" />
            ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‘ì—…
          </h3>
          
          <div className="space-y-3">
            <div className="p-4 bg-red-50 border-l-4 border-red-400 rounded-lg">
              <div className="flex items-center gap-3 mb-2">
                <Bell className="w-6 h-6 text-red-600 animate-bounce" />
                <div>
                  <div className="font-bold text-red-800">ê¸´ê¸‰: ì˜¤ì „ ê´€ìˆ˜ í•„ìˆ˜</div>
                  <div className="text-sm text-red-600">í† ì–‘ìŠµë„ 45%, ì„ê³„ì  ë„ë‹¬</div>
                </div>
              </div>
            </div>
            
            <div className="p-4 bg-orange-50 border-l-4 border-orange-400 rounded-lg">
              <div className="flex items-center gap-3">
                <Bug className="w-6 h-6 text-orange-600" />
                <div>
                  <div className="font-bold text-orange-800">ë³‘í•´ì¶© ì˜ˆë°© ë°©ì œ (D-2)</div>
                  <div className="text-sm text-orange-600">ë²¼ë©¸êµ¬ ë°œìƒ ìœ„í—˜ 85%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // 2ë¶€: ì ˆê¸° ë‹¬ë ¥ í™”ë©´
  const SeasonCalendarScreen = () => {
    const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
    const [viewMode, setViewMode] = useState('combined');

    const seasonalCalendar = {
      8: { traditional: 'ì…ì¶”(8/7), ì²˜ì„œ(8/23)', living: 'ì‹¤ì§ˆì…ì¶”(8/10), ì‹¤ì§ˆì²˜ì„œ(8/26)' },
      9: { traditional: 'ë°±ë¡œ(9/7), ì¶”ë¶„(9/22)', living: 'ì‹¤ì§ˆë°±ë¡œ(9/10), ì‹¤ì§ˆì¶”ë¶„(9/25)' },
      10: { traditional: 'í•œë¡œ(10/8), ìƒê°•(10/23)', living: 'ì‹¤ì§ˆí•œë¡œ(10/11), ì‹¤ì§ˆìƒê°•(10/26)' }
    };

    return (
      <div className="p-4 space-y-6 pb-24">
        {/* ë‹¬ë ¥ í—¤ë” */}
        <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl p-5">
          <h2 className="text-2xl font-bold mb-4">ğŸ“… 2024ë…„ ìƒí™œì ˆê¸° ë‹¬ë ¥</h2>
          
          <div className="flex gap-2 mb-4">
            {[
              { key: 'traditional', label: 'ì „í†µì ˆê¸°', icon: 'ğŸ›ï¸' },
              { key: 'living', label: 'ìƒí™œì ˆê¸°', icon: 'ğŸŒ¡ï¸' },
              { key: 'combined', label: 'í†µí•©ë·°', icon: 'ğŸ“Š' }
            ].map(mode => (
              <button
                key={mode.key}
                onClick={() => setViewMode(mode.key)}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${
                  viewMode === mode.key
                    ? 'bg-white text-green-600'
                    : 'bg-white bg-opacity-20 text-white'
                }`}
              >
                {mode.icon} {mode.label}
              </button>
            ))}
          </div>
          
          <div className="flex gap-2 overflow-x-auto">
            {[8, 9, 10, 11, 12].map(month => (
              <button
                key={month}
                onClick={() => setSelectedMonth(month)}
                className={`px-3 py-2 rounded-lg text-sm ${
                  selectedMonth === month
                    ? 'bg-white text-green-600 font-bold'
                    : 'bg-white bg-opacity-20 text-white'
                }`}
              >
                {month + 1}ì›”
              </button>
            ))}
          </div>
        </div>

        {/* ì›”ë³„ ì ˆê¸° ì •ë³´ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4">
            ğŸ“† {selectedMonth + 1}ì›” ë†ì—… ë‹¬ë ¥
          </h3>
          
          {seasonalCalendar[selectedMonth] && (
            <div className="space-y-4">
              <div className="p-3 bg-green-50 rounded-lg">
                <div className="font-semibold text-green-800 mb-1">ğŸ›ï¸ ì „í†µì ˆê¸°</div>
                <div className="text-sm text-green-700">{seasonalCalendar[selectedMonth].traditional}</div>
              </div>
              
              <div className="p-3 bg-blue-50 rounded-lg">
                <div className="font-semibold text-blue-800 mb-1">ğŸŒ¡ï¸ ìƒí™œì ˆê¸°</div>
                <div className="text-sm text-blue-700">{seasonalCalendar[selectedMonth].living}</div>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  };

  // 2ë¶€: ë†ì¥ ê´€ë¦¬ í™”ë©´
  const FarmManagementScreen = () => {
    const [selectedField, setSelectedField] = useState(null);

    return (
      <div className="p-4 space-y-6 pb-24">
        {/* ë†ì¥ ê°œìš” */}
        <div className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl p-5">
          <h2 className="text-2xl font-bold mb-2">ğŸï¸ ìŠ¤ë§ˆíŠ¸ ë†ì¥ ê´€ë¦¬</h2>
          <p className="opacity-90">ì´ ë©´ì : {farmData.totalArea?.toLocaleString()}í‰ â€¢ 3ê°œ êµ¬ì—­</p>
        </div>

        {/* GPS ë†ì¥ ì§€ë„ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4">ğŸ—ºï¸ GPS ë†ì¥ ì§€ë„</h3>
          
          <div className="relative bg-green-50 h-64 rounded-lg border-2 border-green-200 mb-4">
            {farmData.fields?.map((field, idx) => {
              const positions = [
                { top: '10%', left: '10%', width: '35%', height: '40%' },
                { top: '15%', right: '10%', width: '30%', height: '35%' },
                { bottom: '10%', left: '20%', width: '25%', height: '30%' }
              ];
              
              const position = positions[idx] || positions[0];
              
              return (
                <div
                  key={field.id || idx}
                  className={`absolute border-2 rounded-lg p-3 cursor-pointer hover:shadow-lg transition-all border-green-400 bg-green-100 ${
                    selectedField?.id === field.id ? 'ring-2 ring-blue-400' : ''
                  }`}
                  style={position}
                  onClick={() => setSelectedField(field)}
                >
                  <div className="font-bold text-sm">{field.name}</div>
                  <div className="text-xs text-gray-600 mb-2">
                    {field.crop === 'rice' ? 'ğŸŒ¾ ë²¼' : field.crop === 'cabbage' ? 'ğŸ¥¬ ë°°ì¶”' : 'ğŸ… í† ë§ˆí† '}
                    ({field.area?.toLocaleString()}í‰)
                  </div>
                  
                  <div className="text-xs space-y-1">
                    <div>ìŠµë„: {field.moisture || 65}%</div>
                    <div>ì˜¨ë„: {sensors.soilTemp?.toFixed(1)}Â°C</div>
                  </div>
                </div>
              );
            })}
          </div>

          {selectedField && (
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <h4 className="font-bold text-blue-800 mb-3">{selectedField.name} ìƒì„¸ ì •ë³´</h4>
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <div><strong>ì‘ë¬¼:</strong> {selectedField.crop === 'rice' ? 'ë²¼' : 'ë°°ì¶”'}</div>
                  <div><strong>ë©´ì :</strong> {selectedField.area?.toLocaleString()}í‰</div>
                </div>
                <div>
                  <div><strong>ìŠµë„:</strong> {selectedField.moisture || 65}%</div>
                  <div><strong>ìƒíƒœ:</strong> ì–‘í˜¸</div>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* ì„¼ì„œ ë°ì´í„° */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4">ğŸ“Š ì‹¤ì‹œê°„ ì„¼ì„œ ëª¨ë‹ˆí„°ë§</h3>
          
          <div className="grid grid-cols-2 gap-4">
            <div className="p-4 bg-red-50 rounded-lg text-center">
              <Thermometer className="w-8 h-8 text-red-500 mx-auto mb-2" />
              <div className="font-bold text-xl text-red-600">{sensors.airTemp?.toFixed(1)}Â°C</div>
              <div className="text-sm text-gray-600">ê¸°ì˜¨</div>
            </div>
            
            <div className="p-4 bg-blue-50 rounded-lg text-center">
              <Droplets className="w-8 h-8 text-blue-500 mx-auto mb-2" />
              <div className="font-bold text-xl text-blue-600">{sensors.humidity?.toFixed(0)}%</div>
              <div className="text-sm text-gray-600">ìŠµë„</div>
            </div>
            
            <div className="p-4 bg-green-50 rounded-lg text-center">
              <Activity className="w-8 h-8 text-green-500 mx-auto mb-2" />
              <div className="font-bold text-xl text-green-600">{sensors.ph?.toFixed(1)}</div>
              <div className="text-sm text-gray-600">í† ì–‘ pH</div>
            </div>
            
            <div className="p-4 bg-yellow-50 rounded-lg text-center">
              <Sun className="w-8 h-8 text-yellow-500 mx-auto mb-2" />
              <div className="font-bold text-xl text-yellow-600">{((sensors.lightIntensity || 45000)/1000)?.toFixed(0)}</div>
              <div className="text-sm text-gray-600">ì¡°ë„(klx)</div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // 3ë¶€: ì»¤ë®¤ë‹ˆí‹° í™”ë©´
  const CommunityScreen = () => {
    const chatRooms = [
      { id: 1, name: 'ê³µì£¼ì‹œ ë²¼ë†ì‚¬ ëª¨ì„', members: 45, active: 12, lastMessage: 'ë°©ì œ ê²°ê³¼ ê³µìœ í•©ë‹ˆë‹¤' },
      { id: 2, name: 'í­ì—¼ ëŒ€ì‘ ê¸´ê¸‰ë°©', members: 128, active: 34, lastMessage: 'ê´€ìˆ˜ ì‹œìŠ¤í…œ ê³ ì¥ë‚¬ì–´ìš”' },
      { id: 3, name: 'ìŠ¤ë§ˆíŠ¸íŒœ ê¸°ìˆ êµë¥˜', members: 89, active: 15, lastMessage: 'ë“œë¡  ë°©ì œ í›„ê¸°' }
    ];

    const experts = [
      { id: 1, name: 'ë°•ì‘ë¬¼ë°•ì‚¬', specialty: 'ë³‘í•´ì¶© ë°©ì œ', rating: 4.9, status: 'online' },
      { id: 2, name: 'ì´í† ì–‘ì „ë¬¸ê°€', specialty: 'í† ì–‘ ê°œëŸ‰', rating: 4.8, status: 'busy' },
      { id: 3, name: 'ì •ìŠ¤ë§ˆíŠ¸íŒœ', specialty: 'ìŠ¤ë§ˆíŠ¸íŒœ ì„¤ê³„', rating: 4.7, status: 'online' }
    ];

    return (
      <div className="p-4 space-y-6 pb-24">
        {/* ì‹¤ì‹œê°„ ì±„íŒ… */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
            <MessageSquare className="w-6 h-6 text-indigo-600" />
            ì‹¤ì‹œê°„ ë†ì—… ì±„íŒ…
          </h3>

          {!activeChatRoom ? (
            <div className="space-y-3">
              {chatRooms.map(room => (
                <div 
                  key={room.id} 
                  className="p-4 border border-gray-200 rounded-lg hover:border-indigo-300 cursor-pointer"
                  onClick={() => setActiveChatRoom(room)}
                >
                  <div className="flex items-center justify-between mb-2">
                    <div className="font-semibold text-indigo-800">{room.name}</div>
                    <div className="flex items-center gap-1 text-xs text-green-600">
                      <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                      {room.active}ëª… í™œì„±
                    </div>
                  </div>
                  <div className="text-sm text-gray-600">{room.lastMessage}</div>
                  <div className="text-xs text-gray-500">ì´ {room.members}ëª… ì°¸ì—¬</div>
                </div>
              ))}
            </div>
          ) : (
            <div>
              <div className="flex items-center justify-between mb-4">
                <div className="font-bold text-indigo-800">{activeChatRoom.name}</div>
                <button onClick={() => setActiveChatRoom(null)}>
                  <X className="w-5 h-5" />
                </button>
              </div>
              
              <div className="space-y-3 mb-4 h-40 overflow-y-auto bg-gray-50 rounded p-3">
                <div className="flex justify-start">
                  <div className="bg-white p-2 rounded-lg max-w-xs">
                    <div className="text-xs text-gray-500 mb-1">ê¹€ë†ë¶€ â€¢ 14:35</div>
                    <div className="text-sm">ë²¼ë©¸êµ¬ ë°©ì œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. íš¨ê³¼ ì¢‹ë„¤ìš”!</div>
                  </div>
                </div>
                <div className="flex justify-end">
                  <div className="bg-indigo-600 text-white p-2 rounded-lg max-w-xs">
                    <div className="text-sm">ìš°ë¦¬ ë™ë„¤ëŠ” ì•„ì§ ê´œì°®ì€ ê²ƒ ê°™ì€ë°ìš”</div>
                  </div>
                </div>
              </div>

              <div className="flex gap-2">
                <input
                  type="text"
                  value={newMessage}
                  onChange={(e) => setNewMessage(e.target.value)}
                  placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                  className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                />
                <button className="px-4 py-2 bg-indigo-600 text-white rounded-lg">
                  <Send className="w-5 h-5" />
                </button>
              </div>
            </div>
          )}
        </div>

        {/* ì „ë¬¸ê°€ ìƒë‹´ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
            <UserCheck className="w-6 h-6 text-blue-600" />
            ì „ë¬¸ê°€ ì‹¤ì‹œê°„ ìƒë‹´
          </h3>

          {!liveConsultation ? (
            <div className="space-y-4">
              {experts.map(expert => (
                <div key={expert.id} className="p-4 border border-gray-200 rounded-lg">
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                        {expert.name.charAt(0)}
                      </div>
                      <div>
                        <div className="font-bold flex items-center gap-2">
                          {expert.name}
                          <Verified className="w-4 h-4 text-blue-600" />
                        </div>
                        <div className="text-sm text-gray-600">{expert.specialty}</div>
                        <div className="flex items-center gap-1 mt-1">
                          <Star className="w-4 h-4 text-yellow-500 fill-current" />
                          <span className="text-sm">{expert.rating}</span>
                        </div>
                      </div>
                    </div>
                    <div className={`w-3 h-3 rounded-full ${
                      expert.status === 'online' ? 'bg-green-400' : 'bg-yellow-400'
                    }`}></div>
                  </div>

                  <div className="flex gap-2">
                    <button 
                      onClick={() => setLiveConsultation(expert)}
                      disabled={expert.status !== 'online'}
                      className={`flex-1 py-2 rounded text-sm font-medium ${
                        expert.status === 'online'
                          ? 'bg-green-600 text-white'
                          : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                      }`}
                    >
                      <Video className="w-4 h-4 inline mr-1" />
                      í™”ìƒ ìƒë‹´
                    </button>
                    <button className="flex-1 py-2 bg-blue-600 text-white rounded text-sm">
                      <MessageCircle className="w-4 h-4 inline mr-1" />
                      ì±„íŒ… ìƒë‹´
                    </button>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div>
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                    {liveConsultation.name.charAt(0)}
                  </div>
                  <div>
                    <div className="font-bold">{liveConsultation.name}</div>
                    <div className="text-sm text-green-600">ìƒë‹´ ì§„í–‰ì¤‘</div>
                  </div>
                </div>
                <button 
                  onClick={() => setLiveConsultation(null)}
                  className="px-3 py-1 bg-red-500 text-white rounded text-sm"
                >
                  ìƒë‹´ ì¢…ë£Œ
                </button>
              </div>

              <div className="bg-gray-100 rounded-lg p-4 mb-4 h-48 flex items-center justify-center">
                <div className="text-center text-gray-600">
                  <Video className="w-16 h-16 mx-auto mb-2 opacity-50" />
                  <div>í™”ìƒ ìƒë‹´ ì—°ê²°ì¤‘...</div>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* ì‹œì¥ê°€ê²© ì •ë³´ */}
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
            <TrendingUp className="w-6 h-6 text-green-600" />
            ì‹¤ì‹œê°„ ë†ì‚°ë¬¼ ì‹œì„¸
          </h3>

          <div className="space-y-3">
            {[
              { name: 'ìŒ€(ì¼ë°˜)', price: 52000, change: '+8.3%', trend: 'up' },
              { name: 'ë°°ì¶”', price: 800, change: '-33.3%', trend: 'down' },
              { name: 'í† ë§ˆí† ', price: 3200, change: '+10.3%', trend: 'up' }
            ].map((item, idx) => (
              <div key={idx} className="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                <div className="flex items-center gap-3">
                  <span className="text-xl">
                    {item.name.includes('ìŒ€') ? 'ğŸŒ¾' : item.name.includes('ë°°ì¶”') ? 'ğŸ¥¬' : 'ğŸ…'}
                  </span>
                  <div>
                    <div className="font-medium">{item.name}</div>
                    <div className="text-sm text-gray-600">{item.price.toLocaleString()}ì›</div>
                  </div>
                </div>
                <div className={`flex items-center gap-1 ${
                  item.trend === 'up' ? 'text-red-600' : 'text-blue-600'
                }`}>
                  {item.trend === 'up' ? <ArrowUp className="w-4 h-4" /> : <ArrowDown className="w-4 h-4" />}
                  <span className="font-semibold">{item.change}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ì„¤ì • í™”ë©´
  const SettingsScreen = () => {
    return (
      <div className="p-4 space-y-6 pb-24">
        <div className="bg-white rounded-xl shadow-lg p-5">
          <h2 className="text-2xl font-bold mb-4">âš™ï¸ ì•± ì„¤ì •</h2>
          
          <div className="space-y-4">
            <div className="p-4 bg-green-50 rounded-lg">
              <div className="font-semibold text-green-800 mb-2">ğŸ‘¤ ë†ë¶€ í”„ë¡œí•„</div>
              <div className="space-y-2 text-sm">
                <div>ì´ë¦„: {userProfile.name}</div>
                <div>ì§€ì—­: {userProfile.location}</div>
                <div>ë“±ê¸‰: {userProfile.level} ({userProfile.points}P)</div>
                <div>ë†ì—…ê²½ë ¥: {userProfile.experience}ë…„</div>
              </div>
            </div>
            
            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
              <div>
                <div className="font-medium">ğŸ”Š ìŒì„± ì•ˆë‚´</div>
                <div className="text-sm text-gray-600">ì‘ì—… ì•Œë¦¼ì„ ìŒì„±ìœ¼ë¡œ ì•ˆë‚´</div>
              </div>
              <button 
                onClick={() => setVoiceEnabled(!voiceEnabled)}
                className={`w-12 h-6 rounded-full transition-colors ${
                  voiceEnabled ? 'bg-green-500' : 'bg-gray-300'
                }`}
              >
                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${
                  voiceEnabled ? 'translate-x-6' : 'translate-x-0.5'
                }`}></div>
              </button>
            </div>
            
            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
              <div>
                <div className="font-medium">ğŸ“¶ ì˜¤í”„ë¼ì¸ ëª¨ë“œ</div>
                <div className="text-sm text-gray-600">ë„¤íŠ¸ì›Œí¬ ì—†ì´ ê¸°ë³¸ ê¸°ëŠ¥ ì‚¬ìš©</div>
              </div>
              <button 
                onClick={() => setIsOffline(!isOffline)}
                className={`w-12 h-6 rounded-full transition-colors ${
                  isOffline ? 'bg-yellow-500' : 'bg-gray-300'
                }`}
              >
                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${
                  isOffline ? 'translate-x-6' : 'translate-x-0.5'
                }`}></div>
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸
  const updateSensorData = useCallback(() => {
    setSensors({
      airTemp: 32 + Math.random() * 4,
      soilTemp: 24 + Math.random() * 4,
      humidity: 65 + Math.random() * 20,
      soilMoisture: 45 + Math.random() * 20,
      ph: 6.0 + Math.random() * 0.8,
      lightIntensity: 45000 + Math.random() * 10000
    });
  }, []);

  // ë°ì´í„° ì´ˆê¸°í™”
  useEffect(() => {
    const initializeApp = () => {
      setUserProfile({
        name: 'ê¹€ë†ë¶€',
        location: 'ê³µì£¼ì‹œ ìœ êµ¬ì',
        level: 'Gold',
        points: 3450,
        experience: 15
      });

      setFarmData({
        totalArea: 5000,
        fields: [
          { id: 'field1', name: '1êµ¬ì—­ ë…¼', crop: 'rice', area: 3000, moisture: 78 },
          { id: 'field2', name: '2êµ¬ì—­ ë°­', crop: 'cabbage', area: 1500, moisture: 65 },
          { id: 'field3', name: '3êµ¬ì—­ ì˜¨ì‹¤', crop: 'tomato', area: 800, moisture: 72 }
        ]
      });

      setCrops([
        { name: 'ë²¼', type: 'rice', stage: 'ìˆ˜ì‰ê¸°', progress: 75, nextTask: 'ë³‘í•´ì¶© ë°©ì œ', daysLeft: 3 },
        { name: 'ë°°ì¶”', type: 'cabbage', stage: 'ê²°êµ¬ì‹œì‘', progress: 60, nextTask: 'ì›ƒê±°ë¦„', daysLeft: 5 }
      ]);

      setDevices([
        { name: 'ê´€ìˆ˜ì‹œìŠ¤í…œ', status: 'active' },
        { name: 'í™˜ê¸°ì‹œìŠ¤í…œ', status: 'standby' },
        { name: 'AIì¹´ë©”ë¼', status: 'monitoring' }
      ]);

      setAlerts([
        {
          title: 'í­ì—¼ ì£¼ì˜ë³´',
          message: 'ë‚´ì¼ ìµœê³ ê¸°ì˜¨ 36Â°C ì˜ˆìƒ, ê¸´ê¸‰ ê´€ìˆ˜ í•„ìš”'
        }
      ]);

      setNotifications([
        { id: 1, title: 'í­ì—¼ê²½ë³´', message: 'ë‚´ì¼ ìµœê³ ê¸°ì˜¨ 36Â°C', urgent: true },
        { id: 2, title: 'ì‘ì—…ì•Œë¦¼', message: 'ë²¼ ë³‘í•´ì¶© ë°©ì œ D-3', urgent: false }
      ]);

      updateSensorData();
    };

    initializeApp();
  }, [updateSensorData]);

  // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê´€ë¦¬
  useEffect(() => {
    const handleOnline = () => setIsOffline(false);
    const handleOffline = () => setIsOffline(true);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  // í™”ë©´ ì „í™˜ í•¨ìˆ˜
  const switchScreen = (screen) => {
    setCurrentScreen(screen);
    setIsMenuOpen(false);
    if (voiceEnabled) {
      const screenName = {
        'home': 'í™ˆ í™”ë©´',
        'calendar': 'ì ˆê¸° ë‹¬ë ¥',
        'farm': 'ë†ì¥ ê´€ë¦¬',
        'community': 'ì»¤ë®¤ë‹ˆí‹°',
        'settings': 'ì„¤ì •'
      }[screen];
      speakText(`${screenName}ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤`);
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-green-600 flex items-center justify-center">
        <div className="text-center text-white">
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
          <h2 className="text-xl font-bold">ë†ì¥ ë°ì´í„° ë¡œë”© ì¤‘...</h2>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ìƒë‹¨ í—¤ë” */}
      <div className="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <button 
              onClick={() => setIsMenuOpen(!isMenuOpen)}
              className="p-2 hover:bg-green-700 rounded-lg"
            >
              <Menu className="w-6 h-6" />
            </button>
            <div>
              <h1 className="text-xl font-bold">ìŠ¤ë§ˆíŠ¸ ìƒí™œì ˆê¸°</h1>
              <p className="text-xs opacity-90">AI ë†ì—… í†µí•© í”Œë«í¼</p>
            </div>
          </div>
          
          <div className="flex items-center gap-2">
            {isOffline ? <WifiOff className="w-5 h-5 text-red-300" /> : <Wifi className="w-5 h-5 text-green-300" />}
            
            <button 
              onClick={() => setVoiceEnabled(!voiceEnabled)}
              className={`p-2 rounded-lg ${voiceEnabled ? 'bg-green-500' : 'bg-green-700'}`}
            >
              <Volume2 className="w-5 h-5" />
            </button>
            
            <button 
              onClick={() => setShowNotifications(!showNotifications)}
              className="relative p-2 hover:bg-green-700 rounded-lg"
            >
              <Bell className="w-5 h-5" />
              {notifications.length > 0 && (
                <span className="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">
                  {notifications.length}
                </span>
              )}
            </button>
            
            <div className="text-xs text-center">
              <div>{userProfile.level}</div>
              <div className="text-yellow-200">{userProfile.points}P</div>
            </div>
          </div>
        </div>
      </div>

      {/* ì‚¬ì´ë“œ ë©”ë‰´ */}
      {isMenuOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={() => setIsMenuOpen(false)}>
          <div className="fixed left-0 top-0 h-full w-80 bg-white shadow-xl">
            <div className="p-4 bg-green-600 text-white">
              <div className="flex items-center justify-between">
                <div>
                  <div className="font-bold text-lg">{userProfile.name}</div>
                  <div className="text-sm opacity-90">{userProfile.location}</div>
                </div>
                <button onClick={() => setIsMenuOpen(false)}>
                  <X className="w-6 h-6" />
                </button>
              </div>
            </div>
            
            <div className="p-4 space-y-3">
              <div className="font-semibold text-gray-800 mb-3">ë¹ ë¥¸ ë©”ë‰´</div>
              {[
                { icon: Calculator, text: 'ë†ì—… ê³„ì‚°ê¸°' },
                { icon: Camera, text: 'ë³‘í•´ì¶© ì§„ë‹¨' },
                { icon: Phone, text: 'ì‘ê¸‰ ìƒë‹´' },
                { icon: HelpCircle, text: 'ë„ì›€ë§' }
              ].map((item, idx) => (
                <button 
                  key={idx}
                  className="w-full flex items-center gap-3 p-3 hover:bg-gray-100 rounded-lg text-left"
                >
                  <item.icon className="w-5 h-5 text-green-600" />
                  <span>{item.text}</span>
                </button>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* ì•Œë¦¼ íŒ¨ë„ */}
      {showNotifications && (
        <div className="fixed top-16 right-4 w-80 bg-white rounded-lg shadow-xl border z-30 max-h-96 overflow-y-auto">
          <div className="p-4 border-b bg-gray-50">
            <div className="flex items-center justify-between">
              <div className="font-bold">ì•Œë¦¼ ({notifications.length})</div>
              <button onClick={() => setShowNotifications(false)}>
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>
          
          <div className="p-2">
            {notifications.map(notif => (
              <div key={notif.id} className={`p-3 border-l-4 rounded-lg mb-2 ${
                notif.urgent ? 'bg-red-50 border-red-400' : 'bg-blue-50 border-blue-400'
              }`}>
                <div className="font-medium text-sm">{notif.title}</div>
                <div className="text-xs text-gray-600 mt-1">{notif.message}</div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ë©”ì¸ ì½˜í…ì¸  */}
      <div className="pb-20">
        {currentScreen === 'home' && <MainHomeScreen />}
        {currentScreen === 'calendar' && <SeasonCalendarScreen />}
        {currentScreen === 'farm' && <FarmManagementScreen />}
        {currentScreen === 'community' && <CommunityScreen />}
        {currentScreen === 'settings' && <SettingsScreen />}
      </div>

      {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
        <div className="flex justify-around px-2 py-2">
          {[
            { key: 'home', icon: Home, label: 'í™ˆ' },
            { key: 'calendar', icon: Calendar, label: 'ì ˆê¸°ë‹¬ë ¥' },
            { key: 'farm', icon: Map, label: 'ë†ì¥ê´€ë¦¬' },
            { key: 'community', icon: Users, label: 'ì»¤ë®¤ë‹ˆí‹°' },
            { key: 'settings', icon: Settings, label: 'ì„¤ì •' }
          ].map(nav => (
            <button
              key={nav.key}
              onClick={() => switchScreen(nav.key)}
              className={`flex flex-col items-center p-2 transition-colors ${
                currentScreen === nav.key ? 'text-green-600' : 'text-gray-400'
              }`}
            >
              <nav.icon className="w-6 h-6 mb-1" />
              <span className="text-xs">{nav.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ */}
      {isOffline && (
        <div className="fixed bottom-20 left-4 right-4 bg-yellow-500 text-white p-3 rounded-lg shadow-lg z-20">
          <div className="flex items-center gap-2">
            <WifiOff className="w-5 h-5" />
            <div className="flex-1">
              <div className="font-medium">ì˜¤í”„ë¼ì¸ ëª¨ë“œ</div>
              <div className="text-sm opacity-90">ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì‚¬ìš© ê°€ëŠ¥</div>
            </div>
            <button 
              onClick={() => setIsOffline(false)}
              className="px-3 py-1 bg-yellow-600 rounded text-sm"
            >
              ì¬ì—°ê²°
            </button>
          </div>
        </div>
      )}

      {/* ì‘ê¸‰ ìƒí™© ë²„íŠ¼ */}
      <button 
        onClick={() => speakText('ì‘ê¸‰ ìƒí™©ì…ë‹ˆë‹¤. ì „ë¬¸ê°€ì™€ ì—°ê²° ì¤‘ì…ë‹ˆë‹¤')}
        className="fixed bottom-24 right-4 w-14 h-14 bg-red-500 text-white rounded-full shadow-lg flex items-center justify-center z-30 animate-pulse"
      >
        <Phone className="w-6 h-6" />
      </button>

      {/* ìŒì„± ì•ˆë‚´ ìƒíƒœ */}
      {voiceEnabled && (
        <div className="fixed top-20 left-4 bg-green-500 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2 z-20">
          <Volume2 className="w-4 h-4" />
          ìŒì„±ì•ˆë‚´ ON
        </div>
      )}
    </div>
  );
};

export default CompleteFarmingAppFinal;
