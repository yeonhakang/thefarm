import React, { useState, useEffect, useCallback } from 'react';
import { 
  Calendar, Thermometer, CloudRain, Sun, Wind, AlertTriangle, TrendingUp, 
  MapPin, Clock, Bell, Droplets, Eye, Activity, Settings, Camera, Bug, Leaf, 
  Calculator, Map, BarChart3, Timer, Zap, CheckCircle, Users, MessageCircle, 
  Star, Award, Phone, Volume2, Wifi, Target, Menu, X, Plus, Send, ThumbsUp, 
  Share, Save, RefreshCw, Download, Home, ChevronRight, Database, Brain,
  User, Mail, HelpCircle, Verified, Shield
} from 'lucide-react';

const CROP_DATABASE = {
  rice: {
    name: 'ë²¼',
    baseTemp: 10,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì¤€ë¹„', 'ë…¼ ì •ë¦¬'] },
      { stage: 'ë°œì•„', gdd: 120, tasks: ['ë¬¼ ê´€ë¦¬', 'ì˜¨ë„ ì¡°ì ˆ'] },
      { stage: 'ë¶„ì–¼', gdd: 400, tasks: ['ì œì´ˆ', 'ì¶”ë¹„ì‹œìš©'] },
      { stage: 'ìˆ˜ì‰', gdd: 800, tasks: ['ë¬¼ ê¹Šì´ ì¡°ì ˆ', 'ë³‘í•´ì¶© ë°©ì œ'] },
      { stage: 'ì¶œìˆ˜', gdd: 1200, tasks: ['ìˆ˜ë¶„ ê´€ë¦¬', 'ì¡°ë¥˜ ë°©ì œ'] },
      { stage: 'ì„±ìˆ™', gdd: 1600, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ê±´ì¡° ì¤€ë¹„'] }
    ]
  },
  cabbage: {
    name: 'ë°°ì¶”',
    baseTemp: 5,
    gddStages: [
      { stage: 'íŒŒì¢…', gdd: 0, tasks: ['ì¢…ì ì†Œë…', 'ìƒí†  ì¤€ë¹„'] },
      { stage: 'ë°œì•„', gdd: 80, tasks: ['ì˜¨ë„ ê´€ë¦¬', 'ìŠµë„ ì¡°ì ˆ'] },
      { stage: 'ë³¸ì—½', gdd: 200, tasks: ['ê°„ì‹', 'ì›ƒê±°ë¦„'] },
      { stage: 'ê²°êµ¬ì‹œì‘', gdd: 500, tasks: ['ì¶©ë¶„í•œ ê´€ìˆ˜', 'í† ì–‘ ê´€ë¦¬'] },
      { stage: 'ê²°êµ¬ì™„ì„±', gdd: 800, tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ì €ì¥ ì¤€ë¹„'] }
    ]
  }
};

const SmartFarmApp = () => {
  const [currentScreen, setCurrentScreen] = useState('home');
  const [voiceEnabled, setVoiceEnabled] = useState(false);
  const [userProfile, setUserProfile] = useState({});
  const [farmData, setFarmData] = useState({});
  const [crops, setCrops] = useState([]);
  const [sensors, setSensors] = useState({});
  const [alerts, setAlerts] = useState([]);
  const [livingSeasons, setLivingSeasons] = useState({});
  const [activeChatRoom, setActiveChatRoom] = useState(null);
  const [newMessage, setNewMessage] = useState('');
  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());

  const speakText = useCallback((text) => {
    if (voiceEnabled && 'speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ko-KR';
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);
    }
  }, [voiceEnabled]);

  const updateSensorData = useCallback(() => {
    setSensors({
      soilMoisture: 45 + Math.random() * 20,
      soilTemp: 24 + Math.random() * 4,
      airTemp: 32 + Math.random() * 6,
      humidity: 70 + Math.random() * 15,
      ph: 6.2 + Math.random() * 0.6,
      lightIntensity: 45000 + Math.random() * 10000
    });
  }, []);

  useEffect(() => {
    setUserProfile({ name: 'ê¹€ë†ë¶€', location: 'ê³µì£¼ì‹œ ìœ êµ¬ì', level: 'Gold', points: 3450 });
    setFarmData({ totalArea: 5000 });
    setCrops([
      { id: 1, name: 'ë²¼ (ì¶”ì²­)', type: 'rice', variety: 'ì¶”ì²­', area: 3000, stage: 'ì„±ìˆ™ê¸°', nextStage: 'ìˆ˜í™•', progress: 78, gddAccumulated: 1247, healthStatus: 'good', tasks: ['ìˆ˜í™• ì¤€ë¹„', 'ê±´ì¡° ì¤€ë¹„'], daysToNext: 5 },
      { id: 2, name: 'ë°°ì¶” (ë¶ˆì•”3í˜¸)', type: 'cabbage', variety: 'ë¶ˆì•”3í˜¸', area: 1500, stage: 'ì •ì‹ ëŒ€ê¸°', nextStage: 'ë³¸ì—½', progress: 0, gddAccumulated: 0, healthStatus: 'good', tasks: ['ì¢…ì ì†Œë…', 'ìƒí†  ì¤€ë¹„'], daysToNext: 15 }
    ]);
    setAlerts([
      { title: 'ê·¹í•œí­ì—¼ ê²½ë³´', severity: 'critical', message: '3ì¼ ì—°ì† 35Â°C ì´ìƒ, ì‘ë¬¼ ê³ ì‚¬ ìœ„í—˜', actions: ['ê¸´ê¸‰ ê´€ìˆ˜ ì‹œìŠ¤í…œ ê°€ë™', 'ì°¨ê´‘ë§ 100% ì„¤ì¹˜'] }
    ]);
    setLivingSeasons({
      traditional: { name: 'ì²˜ì„œ', date: '8ì›” 23ì¼', expectedTemp: 28 },
      living: { name: 'ì‹¤ì§ˆì²˜ì„œ', date: '8ì›” 26ì¼', actualTemp: 31.2, adjustment: '+3ì¼' }
    });
    updateSensorData();
    const interval = setInterval(updateSensorData, 5000);
    return () => clearInterval(interval);
  }, [updateSensorData]);

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 sticky top-0 z-50">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="text-2xl">ğŸŒ¾</div>
            <div>
              <h1 className="text-xl font-bold">ìŠ¤ë§ˆíŠ¸ ìƒí™œì ˆê¸°</h1>
              <p className="text-xs opacity-90">{userProfile.name || 'ë†ë¶€'} â€¢ {userProfile.location || 'ê³µì£¼ì‹œ'}</p>
            </div>
          </div>
          <div className="flex items-center gap-2">
            <Wifi className="w-5 h-5" />
            <button onClick={() => setVoiceEnabled(!voiceEnabled)} className={`p-2 rounded ${voiceEnabled ? 'bg-green-500' : 'bg-green-700'}`}>
              <Volume2 className="w-5 h-5" />
            </button>
          </div>
        </div>
      </div>

      <div className="pb-20">
        {currentScreen === 'home' && (
          <div className="p-4 space-y-6 pb-24">
            {alerts.length > 0 && (
              <div className="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl p-4 shadow-lg">
                <div className="flex items-center gap-2 text-red-800 font-bold mb-3">
                  <AlertTriangle className="w-6 h-6 animate-pulse" />
                  ê¸´ê¸‰ ë†ì—… ì•Œë¦¼ ({alerts.length}ê±´)
                </div>
                {alerts.map((alert, idx) => (
                  <div key={idx} className="mb-3">
                    <div className="flex items-center justify-between mb-2">
                      <span className="px-3 py-1 rounded-full text-sm font-semibold bg-red-500 text-white">{alert.title}</span>
                      <button onClick={() => speakText(alert.message)} className="text-red-600"><Volume2 className="w-4 h-4" /></button>
                    </div>
                    <div className="text-red-700 text-sm mb-2">{alert.message}</div>
                    {alert.actions?.map((action, i) => (
                      <div key={i} className="flex items-center gap-2 text-xs text-red-600">
                        <CheckCircle className="w-3 h-3 text-green-600" /><span>â€¢ {action}</span>
                      </div>
                    ))}
                  </div>
                ))}
              </div>
            )}
            <div className="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
                <Calendar className="w-6 h-6 text-green-600" />ì˜¤ëŠ˜ì˜ ìƒí™œì ˆê¸°
              </h3>
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div className="text-center p-4 bg-green-100 rounded-lg">
                  <div className="text-sm text-gray-600 mb-1">ì „í†µì ˆê¸°</div>
                  <div className="font-bold text-xl text-green-700">{livingSeasons?.traditional?.name}</div>
                  <div className="text-xs text-gray-500">{livingSeasons?.traditional?.date}</div>
                  <div className="text-xs text-green-600 mt-1">ì˜ˆìƒê¸°ì˜¨: {livingSeasons?.traditional?.expectedTemp}Â°C</div>
                </div>
                <div className="text-center p-4 bg-blue-100 rounded-lg">
                  <div className="text-sm text-gray-600 mb-1">ìƒí™œì ˆê¸°</div>
                  <div className="font-bold text-xl text-blue-700">{livingSeasons?.living?.name}</div>
                  <div className="text-xs text-gray-500">{livingSeasons?.living?.date}</div>
                  <div className="text-xs text-blue-600 mt-1">ì‹¤ì œê¸°ì˜¨: {livingSeasons?.living?.actualTemp}Â°C</div>
                </div>
              </div>
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                <div className="font-semibold text-yellow-800 mb-1">ì ˆê¸° ë¶„ì„</div>
                <div className="text-sm text-yellow-700">ì˜¬í•´ëŠ” í‰ë…„ë³´ë‹¤ {livingSeasons?.living?.adjustment} ëŠ¦ì€ ì ˆê¸°ë¡œ, ê¸°í›„ë³€í™”ì˜ ì˜í–¥ìœ¼ë¡œ ìƒìœ¡ê¸°ê°„ì´ ì—°ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
              </div>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
                <TrendingUp className="w-6 h-6 text-orange-600" />ìƒìœ¡ë„ì¼(GDD) ì‹¤ì‹œê°„ í˜„í™©
              </h3>
              {crops.map((crop) => (
                <div key={crop.id} className="mb-6 last:mb-0 p-4 border border-gray-200 rounded-lg">
                  <div className="flex justify-between items-center mb-3">
                    <div className="flex items-center gap-3">
                      <div className="text-2xl">{crop.type === 'rice' ? 'ğŸŒ¾' : 'ğŸ¥¬'}</div>
                      <div>
                        <div className="font-bold text-lg">{crop.name}</div>
                        <div className="text-sm text-gray-600">{crop.variety} â€¢ {crop.area}í‰</div>
                      </div>
                    </div>
                    <div className={`px-3 py-1 rounded-full text-sm font-semibold ${crop.healthStatus === 'good' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>
                      {crop.healthStatus === 'good' ? 'ì–‘í˜¸' : 'ì£¼ì˜'}
                    </div>
                  </div>
                  <div className="mb-3">
                    <div className="flex justify-between items-center mb-2">
                      <span className="text-sm font-medium">í˜„ì¬: {crop.stage}</span>
                      <span className="text-sm text-gray-500">ë‹¤ìŒ: {crop.nextStage} (D-{crop.daysToNext})</span>
                    </div>
                    <div className="bg-gray-200 rounded-full h-4 mb-2">
                      <div className="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full" style={{ width: `${crop.progress}%` }}></div>
                    </div>
                    <div className="flex justify-between text-xs text-gray-600">
                      <span>ëˆ„ì  GDD: {crop.gddAccumulated}Â°C</span>
                      <span>{crop.progress}% ì™„ë£Œ</span>
                    </div>
                  </div>
                  <div className="p-3 bg-blue-50 rounded-lg">
                    <div className="font-semibold text-blue-800 mb-2">{crop.stage} ë‹¨ê³„ ê¶Œì¥ì‘ì—…</div>
                    <div className="flex flex-wrap gap-2">
                      {crop.tasks.map((task, i) => (
                        <span key={i} className="px-2 py-1 bg-blue-200 text-blue-700 rounded text-xs">{task}</span>
                      ))}
                    </div>
                  </div>
                </div>
              ))}
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
                <Zap className="w-6 h-6 text-yellow-600" />AI ìŠ¤ë§ˆíŠ¸íŒœ ìë™ì œì–´
              </h3>
              <div className="grid grid-cols-2 gap-3">
                <div className="p-3 bg-blue-50 rounded-lg">
                  <div className="flex items-center gap-2 mb-2">
                    <Database className="w-5 h-5 text-blue-600" />
                    <span className="font-medium text-blue-800">í† ì–‘ ì„¼ì„œ</span>
                  </div>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between"><span>ìŠµë„:</span><span className="font-bold text-blue-600">{sensors.soilMoisture?.toFixed(0)}%</span></div>
                    <div className="flex justify-between"><span>ì˜¨ë„:</span><span className="font-bold text-blue-600">{sensors.soilTemp?.toFixed(1)}Â°C</span></div>
                    <div className="flex justify-between"><span>pH:</span><span className="font-bold text-blue-600">{sensors.ph?.toFixed(1)}</span></div>
                  </div>
                </div>
                <div className="p-3 bg-green-50 rounded-lg">
                  <div className="flex items-center gap-2 mb-2">
                    <Activity className="w-5 h-5 text-green-600" />
                    <span className="font-medium text-green-800">í™˜ê²½ ì„¼ì„œ</span>
                  </div>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between"><span>ê¸°ì˜¨:</span><span className="font-bold text-green-600">{sensors.airTemp?.toFixed(1)}Â°C</span></div>
                    <div className="flex justify-between"><span>ìŠµë„:</span><span className="font-bold text-green-600">{sensors.humidity?.toFixed(0)}%</span></div>
                    <div className="flex justify-between"><span>ì¡°ë„:</span><span className="font-bold text-green-600">{(sensors.lightIntensity/1000)?.toFixed(0)}klx</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {currentScreen === 'calendar' && (
// ===== Part 1 ë, Part 2ì—ì„œ ê³„ì† =====
          <div className="p-4 space-y-6 pb-24">
            <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl p-5">
              <h2 className="text-2xl font-bold mb-4">2024ë…„ ìƒí™œì ˆê¸° ë‹¬ë ¥</h2>
              <div className="flex gap-2 overflow-x-auto">
                {Array.from({length: 12}, (_, i) => i).map(month => (
                  <button key={month} onClick={() => setSelectedMonth(month)}
                    className={`px-3 py-2 rounded-lg text-sm whitespace-nowrap ${selectedMonth === month ? 'bg-white text-green-600 font-bold' : 'bg-white bg-opacity-20'}`}>
                    {month + 1}ì›”
                  </button>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-lg mb-4">{selectedMonth + 1}ì›” ë†ì—… ë‹¬ë ¥</h3>
              <div className="mb-4 p-3 bg-green-50 rounded-lg">
                <div className="font-semibold text-green-800 mb-1">ì „í†µì ˆê¸°</div>
                <div className="text-sm text-green-700">
                  {selectedMonth === 7 ? 'ì…ì¶”(8/7), ì²˜ì„œ(8/23)' : selectedMonth === 8 ? 'ë°±ë¡œ(9/7), ì¶”ë¶„(9/22)' : 'í•´ë‹¹ ì›” ì ˆê¸°'}
                </div>
              </div>
              <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                <div className="font-semibold text-blue-800 mb-1">ìƒí™œì ˆê¸°</div>
                <div className="text-sm text-blue-700">
                  {selectedMonth === 7 ? 'ì‹¤ì§ˆì…ì¶”(8/10), ì‹¤ì§ˆì²˜ì„œ(8/26)' : selectedMonth === 8 ? 'ì‹¤ì§ˆë°±ë¡œ(9/10), ì‹¤ì§ˆì¶”ë¶„(9/25)' : 'í•´ë‹¹ ì›” ì ˆê¸°'}
                </div>
              </div>
              <div className="p-3 bg-yellow-50 rounded-lg">
                <div className="font-semibold text-yellow-800 mb-2">ì´ë‹¬ì˜ ë†ì‘ì—…</div>
                <div className="space-y-1 text-sm text-yellow-700">
                  <div>ë²¼: {selectedMonth === 7 ? 'ìˆ˜ì‰ê¸° ê´€ë¦¬' : selectedMonth === 8 ? 'ì¶œìˆ˜ê¸° ê´€ë¦¬' : selectedMonth === 9 ? 'ì„±ìˆ™ê¸° ê´€ë¦¬' : 'í•´ë‹¹ ì‘ì—… ì—†ìŒ'}</div>
                  <div>ë°°ì¶”: {selectedMonth === 8 ? 'ê°€ì„ë°°ì¶” íŒŒì¢…' : selectedMonth === 9 ? 'ì •ì‹' : selectedMonth === 10 ? 'ê²°êµ¬ê¸°' : 'í•´ë‹¹ ì‘ì—… ì—†ìŒ'}</div>
                </div>
              </div>
            </div>
          </div>
        )}

        {currentScreen === 'management' && (
          <div className="p-4 space-y-6 pb-24">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl p-5">
              <h2 className="text-2xl font-bold mb-2">ë†ì¥ ê´€ë¦¬</h2>
              <p className="opacity-90">ì‹¤ì‹œê°„ ë†ì¥ ë°ì´í„° ë° ì‘ë¬¼ ê´€ë¦¬</p>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
                <Map className="w-6 h-6 text-green-600" />ë†ì¥ ì§€ë„
              </h3>
              <div className="bg-gradient-to-br from-green-100 to-emerald-100 rounded-lg p-8 text-center">
                <div className="text-4xl mb-2">ğŸ—ºï¸</div>
                <div className="font-semibold text-gray-700">ë†ì¥ ìœ„ì¹˜: {userProfile.location}</div>
                <div className="text-sm text-gray-600 mt-2">ì´ ë©´ì : {farmData.totalArea}í‰</div>
              </div>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-xl mb-4 flex items-center gap-2">
                <BarChart3 className="w-6 h-6 text-blue-600" />ì„¼ì„œ ë°ì´í„° ì°¨íŠ¸
              </h3>
              <div className="grid grid-cols-2 gap-4">
                <div className="p-4 border border-gray-200 rounded-lg">
                  <div className="text-sm text-gray-600 mb-2">í† ì–‘ ìŠµë„</div>
                  <div className="text-2xl font-bold text-blue-600">{sensors.soilMoisture?.toFixed(1)}%</div>
                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div className="bg-blue-500 h-2 rounded-full" style={{ width: `${sensors.soilMoisture}%` }}></div>
                  </div>
                </div>
                <div className="p-4 border border-gray-200 rounded-lg">
                  <div className="text-sm text-gray-600 mb-2">ê¸°ì˜¨</div>
                  <div className="text-2xl font-bold text-red-600">{sensors.airTemp?.toFixed(1)}Â°C</div>
                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div className="bg-red-500 h-2 rounded-full" style={{ width: `${(sensors.airTemp/40)*100}%` }}></div>
                  </div>
                </div>
                <div className="p-4 border border-gray-200 rounded-lg">
                  <div className="text-sm text-gray-600 mb-2">ëŒ€ê¸° ìŠµë„</div>
                  <div className="text-2xl font-bold text-green-600">{sensors.humidity?.toFixed(0)}%</div>
                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div className="bg-green-500 h-2 rounded-full" style={{ width: `${sensors.humidity}%` }}></div>
                  </div>
                </div>
                <div className="p-4 border border-gray-200 rounded-lg">
                  <div className="text-sm text-gray-600 mb-2">í† ì–‘ pH</div>
                  <div className="text-2xl font-bold text-purple-600">{sensors.ph?.toFixed(2)}</div>
                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div className="bg-purple-500 h-2 rounded-full" style={{ width: `${((sensors.ph-5)/3)*100}%` }}></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {currentScreen === 'community' && (
// ===== Part 2 ë, Part 3ì—ì„œ ê³„ì† =====
<div className="p-4 space-y-6 pb-24">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl p-5">
              <h2 className="text-2xl font-bold mb-2">ë†ì—… ì»¤ë®¤ë‹ˆí‹°</h2>
              <p className="opacity-90">ì´ì›ƒ ë†ë¶€ë“¤ê³¼ ì‹¤ì‹œê°„ ì •ë³´ ê³µìœ </p>
            </div>
            {!activeChatRoom ? (
              <>
                <div className="bg-white rounded-xl shadow-lg p-5">
                  <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                    <MessageSquare className="w-6 h-6 text-indigo-600" />ì‹¤ì‹œê°„ ì±„íŒ…ë°©
                  </h3>
                  <div className="space-y-3">
                    {[
                      { id: 1, name: 'ê³µì£¼ì‹œ ë²¼ë†ì‚¬ ëª¨ì„', members: 45, active: 12, lastMessage: 'ë°©ì œ ê²°ê³¼ ê³µìœ í•©ë‹ˆë‹¤', urgent: false },
                      { id: 2, name: 'í­ì—¼ ëŒ€ì‘ ê¸´ê¸‰ë°©', members: 128, active: 34, lastMessage: 'ê´€ìˆ˜ ì‹œìŠ¤í…œ ê³ ì¥ë‚¬ì–´ìš”', urgent: true }
                    ].map(room => (
                      <div key={room.id} className={`p-4 border rounded-lg cursor-pointer hover:border-indigo-300 ${room.urgent ? 'border-red-300 bg-red-50' : 'border-gray-200'}`}
                        onClick={() => setActiveChatRoom(room)}>
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <div className={`font-semibold ${room.urgent ? 'text-red-800' : 'text-indigo-800'}`}>{room.name}</div>
                            {room.urgent && <span className="px-2 py-1 bg-red-500 text-white text-xs rounded-full animate-pulse">ê¸´ê¸‰</span>}
                          </div>
                          <div className="flex items-center gap-1 text-xs text-green-600">
                            <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>{room.active}ëª…
                          </div>
                        </div>
                        <div className="text-sm text-gray-600">{room.lastMessage}</div>
                        <div className="text-xs text-gray-500 mt-1">ì´ {room.members}ëª… ì°¸ì—¬</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="bg-white rounded-xl shadow-lg p-5">
                  <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                    <Users className="w-6 h-6 text-green-600" />ì§€ì—­ ì†Œì‹
                  </h3>
                  <div className="space-y-3">
                    {[
                      { id: 1, author: 'ê¹€ë†ë¶€', location: '1.2km', content: 'ìš°ë¦¬ ë™ë„¤ë„ ë²¼ë©¸êµ¬ ë°œê²¬! ë°©ì œ ê°™ì´ í•˜ì‹¤ë¶„?', likes: 5, comments: 2, urgent: true },
                      { id: 2, author: 'ì´ë†ì‚¬', location: '0.8km', content: 'ë°°ì¶” ì •ì‹í–ˆëŠ”ë° ìƒìœ¡ì´ ì¢‹ë„¤ìš”. ì‚¬ì§„ ê³µìœ í•©ë‹ˆë‹¤.', likes: 8, comments: 4, urgent: false }
                    ].map(post => (
                      <div key={post.id} className={`p-4 border rounded-lg ${post.urgent ? 'border-red-200 bg-red-50' : 'border-gray-200'}`}>
                        <div className="flex items-start justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <div className="w-10 h-10 bg-gradient-to-r from-green-400 to-blue-400 rounded-full flex items-center justify-center text-white font-bold">
                              {post.author[0]}
                            </div>
                            <div>
                              <div className="font-semibold">{post.author}</div>
                              <div className="text-xs text-gray-500">{post.location}</div>
                            </div>
                          </div>
                          {post.urgent && <AlertTriangle className="w-5 h-5 text-red-600" />}
                        </div>
                        <div className="text-sm mb-2">{post.content}</div>
                        <div className="flex items-center gap-4 text-xs text-gray-600">
                          <button className="flex items-center gap-1 hover:text-red-500">
                            <ThumbsUp className="w-4 h-4" />{post.likes}
                          </button>
                          <button className="flex items-center gap-1 hover:text-blue-500">
                            <MessageCircle className="w-4 h-4" />{post.comments}
                          </button>
                          <button className="flex items-center gap-1 hover:text-green-500">
                            <Share className="w-4 h-4" />ê³µìœ 
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </>
            ) : (
              <div className="bg-white rounded-xl shadow-lg p-5">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <div className="font-bold text-indigo-800">{activeChatRoom.name}</div>
                    <div className="text-sm text-gray-600">{activeChatRoom.active}ëª…ì´ ëŒ€í™” ì¤‘</div>
                  </div>
                  <button onClick={() => setActiveChatRoom(null)} className="p-2 hover:bg-gray-100 rounded">
                    <X className="w-5 h-5" />
                  </button>
                </div>
                <div className="space-y-3 mb-4 h-64 overflow-y-auto bg-gray-50 rounded p-3">
                  <div className="flex justify-start">
                    <div className="bg-white p-3 rounded-lg max-w-xs shadow-sm">
                      <div className="text-xs text-gray-500 mb-1">ê¹€ë†ë¶€</div>
                      <div className="text-sm">ë²¼ë©¸êµ¬ ë°©ì œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. íš¨ê³¼ ì¢‹ë„¤ìš”!</div>
                    </div>
                  </div>
                  <div className="flex justify-end">
                    <div className="bg-indigo-600 text-white p-3 rounded-lg max-w-xs">
                      <div className="text-sm">ìš°ë¦¬ ë™ë„¤ëŠ” ì•„ì§ ê´œì°®ì€ ê²ƒ ê°™ì€ë°ìš”</div>
                    </div>
                  </div>
                </div>
                <div className="flex gap-2">
                  <button className="p-2 border border-gray-300 rounded hover:bg-gray-50">
                    <Camera className="w-5 h-5 text-gray-600" />
                  </button>
                  <input type="text" value={newMessage} onChange={(e) => setNewMessage(e.target.value)}
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                    onKeyPress={(e) => e.key === 'Enter' && setNewMessage('')} />
                  <button onClick={() => setNewMessage('')} className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                    <Send className="w-5 h-5" />
                  </button>
                </div>
              </div>
            )}
          </div>
        )}

        {currentScreen === 'settings' && (
// ===== Part 3 ë, Part 4ì—ì„œ ê³„ì† =====
<div className="p-4 space-y-6 pb-24">
            <div className="bg-gradient-to-r from-gray-700 to-gray-900 text-white rounded-xl p-5">
              <h2 className="text-2xl font-bold mb-2">ì„¤ì •</h2>
              <p className="opacity-90">ì•± ì„¤ì • ë° ê³„ì • ê´€ë¦¬</p>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-lg mb-4">í”„ë¡œí•„</h3>
              <div className="flex items-center gap-4 mb-6">
                <div className="w-20 h-20 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                  {userProfile.name?.charAt(0) || 'K'}
                </div>
                <div>
                  <div className="font-bold text-xl">{userProfile.name}</div>
                  <div className="text-gray-600">{userProfile.location}</div>
                  <div className="flex items-center gap-2 mt-1">
                    <Star className="w-4 h-4 text-yellow-500" />
                    <span className="text-sm font-medium">{userProfile.level} ë“±ê¸‰</span>
                    <span className="text-sm text-gray-500">({userProfile.points}P)</span>
                  </div>
                </div>
              </div>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-lg mb-4">ì•Œë¦¼ ì„¤ì •</h3>
              <div className="space-y-4">
                {[
                  { key: 'emergency', label: 'ê¸´ê¸‰ ì•Œë¦¼', desc: 'í­ì—¼, ê°€ë­„ ë“± ê¸´ê¸‰ ìƒí™©', enabled: true },
                  { key: 'weather', label: 'ê¸°ìƒ ì•Œë¦¼', desc: 'ì¼ê¸°ì˜ˆë³´ ë° ê¸°ìƒ ë³€í™”', enabled: true },
                  { key: 'schedule', label: 'ì‘ì—… ì•Œë¦¼', desc: 'ë†ì‘ì—… ì¼ì • ë° ê¶Œì¥ì‚¬í•­', enabled: true },
                  { key: 'sensor', label: 'ì„¼ì„œ ì•Œë¦¼', desc: 'ì„¼ì„œ ì´ìƒ ë° ì„ê³„ê°’ ë„ë‹¬', enabled: true }
                ].map(notification => (
                  <div key={notification.key} className="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <div>
                      <div className="font-medium">{notification.label}</div>
                      <div className="text-sm text-gray-600">{notification.desc}</div>
                    </div>
                    <button className={`w-12 h-6 rounded-full ${notification.enabled ? 'bg-green-500' : 'bg-gray-300'}`}>
                      <div className={`w-5 h-5 bg-white rounded-full transition-transform ${notification.enabled ? 'translate-x-6' : 'translate-x-0.5'}`}></div>
                    </button>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-xl shadow-lg p-5">
              <h3 className="font-bold text-lg mb-4">ì‹œìŠ¤í…œ</h3>
              <div className="space-y-3">
                <button className="w-full flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                  <div className="flex items-center gap-3">
                    <Database className="w-5 h-5 text-gray-600" />
                    <span>ë°ì´í„° ë°±ì—…</span>
                  </div>
                  <ChevronRight className="w-5 h-5 text-gray-400" />
                </button>
                <button className="w-full flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                  <div className="flex items-center gap-3">
                    <HelpCircle className="w-5 h-5 text-gray-600" />
                    <span>ë„ì›€ë§</span>
                  </div>
                  <ChevronRight className="w-5 h-5 text-gray-400" />
                </button>
                <button className="w-full flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5 text-gray-600" />
                    <span>ê³ ê°ì„¼í„°</span>
                  </div>
                  <ChevronRight className="w-5 h-5 text-gray-400" />
                </button>
              </div>
            </div>
          </div>
        )}
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2">
        <div className="flex justify-around">
// ===== Part 4 ë, Part 5ì—ì„œ ê³„ì† =====
<button onClick={() => setCurrentScreen('home')} className={`flex flex-col items-center p-2 ${currentScreen === 'home' ? 'text-green-600' : 'text-gray-400'}`}>
            <Home className="w-6 h-6" />
            <span className="text-xs mt-1">í™ˆ</span>
          </button>
          <button onClick={() => setCurrentScreen('calendar')} className={`flex flex-col items-center p-2 ${currentScreen === 'calendar' ? 'text-green-600' : 'text-gray-400'}`}>
            <Calendar className="w-6 h-6" />
            <span className="text-xs mt-1">ì ˆê¸°ë‹¬ë ¥</span>
          </button>
          <button onClick={() => setCurrentScreen('management')} className={`flex flex-col items-center p-2 ${currentScreen === 'management' ? 'text-green-600' : 'text-gray-400'}`}>
            <BarChart3 className="w-6 h-6" />
            <span className="text-xs mt-1">ê´€ë¦¬</span>
          </button>
          <button onClick={() => setCurrentScreen('community')} className={`flex flex-col items-center p-2 ${currentScreen === 'community' ? 'text-green-600' : 'text-gray-400'}`}>
            <Users className="w-6 h-6" />
            <span className="text-xs mt-1">ì»¤ë®¤ë‹ˆí‹°</span>
          </button>
          <button onClick={() => setCurrentScreen('settings')} className={`flex flex-col items-center p-2 ${currentScreen === 'settings' ? 'text-green-600' : 'text-gray-400'}`}>
            <Settings className="w-6 h-6" />
            <span className="text-xs mt-1">ì„¤ì •</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default SmartFarmApp;
